c2NyaXB0X25hbWUoJ0F1dG9SZXBvcnQnKQpzY3JpcHRfdmVyc2lvbl9udW1iZXIgPSAnMi4yJwpzY3JpcHRfdmVyc2lvbignMi4yJykKc2NyaXB0X2F1dGhvcignUGFwYV9OZXVyb3dpc2UnKQoKcmVxdWlyZSAnbGliLm1vb25sb2FkZXInCmxvY2FsIHNhbXBldiA9IHJlcXVpcmUgJ2xpYi5zYW1wLmV2ZW50cycKbG9jYWwgdmtleXMgPSByZXF1aXJlICd2a2V5cycKbG9jYWwgbWVtb3J5ID0gcmVxdWlyZSAnbWVtb3J5Jwpsb2NhbCByYWtuZXQgPSByZXF1aXJlICdsaWIuc2FtcC5yYWtuZXQnCmxvY2FsIGhvb2sgPSByZXF1aXJlICdsaWIuc2FtcC5ldmVudHMuY29yZScKbG9jYWwgZGxzdGF0dXMgPSByZXF1aXJlKCdtb29ubG9hZGVyJykuZG93bmxvYWRfc3RhdHVzCmxvY2FsIHJlbmRlclRleHQgPSByZW5kZXJDcmVhdGVGb250KCdBcmlhbCcsIDgsIEZDUl9CT0xEICsgRkNSX0JPUkRFUikKbG9jYWwgcmVuZGVyU21hbGxUZXh0ID0gcmVuZGVyQ3JlYXRlRm9udCgnQXJpYWwnLCA2LCBGQ1JfQk9SREVSKQpsb2NhbCBzY3JlZW5YLCBzY3JlZW5ZID0gZ2V0U2NyZWVuUmVzb2x1dGlvbigpCmxvY2FsIGZmaSA9IHJlcXVpcmUgJ2ZmaScKbG9jYWwgaW1ndWkgPSByZXF1aXJlICdpbWd1aScKbG9jYWwgaW5pY2ZnID0gcmVxdWlyZSAnaW5pY2ZnJwpsb2NhbCBlbmNvZGluZyA9IHJlcXVpcmUgJ2VuY29kaW5nJwplbmNvZGluZy5kZWZhdWx0ID0gJ0NQMTI1MScKdTggPSBlbmNvZGluZy5VVEY4CgotLSDR7vXw4O3/5ewg7vDo4+jt4Ov87fP+IPTz7er26P4KbG9jYWwgb3JpZ2luYWxTYW1wQWRkQ2hhdE1lc3NhZ2UgPSBzYW1wQWRkQ2hhdE1lc3NhZ2UKCi0tIMjx7/Dg4uvl7e3g/yD08+3q9uj/Le7huPDy6uAKZnVuY3Rpb24gc2FtcEFkZENoYXRNZXNzYWdlKHRleHQsIGNvbG9yKQogICAgaWYgbm90IHRleHQgdGhlbiByZXR1cm4gZW5kCiAgICB0ZXh0ID0gdG9zdHJpbmcodGV4dCkKICAgIC0tINPh6PDg5ewg6+j47ejlIPbi5fLu4vvlIOru5Psg4iDt4Pfg6+Ug8fLw7uroCiAgICB0ZXh0ID0gdGV4dDpnc3ViKCdeeyV4K30lcyonLCAnJykKICAgIHJldHVybiBvcmlnaW5hbFNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdICcgLi4gdGV4dCwgY29sb3IpCmVuZAoKbG9jYWwgbWVtb3J5X2ZsYWcgPSAweDAwMDAwMCAtLSDA5PDl8SDiIO/g7P/y6CDk6/8g8eL/5+gg8SBDTEVPCmxvY2FsIGVuYWJsZV9hdXRvdXBkYXRlID0gdHJ1ZQpsb2NhbCB1cGRhdGVfdXJsID0gJ2h0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9tYXNsaW5pZC9hdXRvcmVwb3J0L3JlZnMvaGVhZHMvbWFpbi91cGRhdGUuanNvbj9ub2NhY2hlPScgLi4gb3MudGltZSgpCmxvY2FsIHNjcmlwdF9wYXRoID0gdGhpc1NjcmlwdCgpLnBhdGgKbG9jYWwgc2NyaXB0X2RpciA9IGdldFdvcmtpbmdEaXJlY3RvcnkoKSAuLiAnXFxtb29ubG9hZGVyXFwnCmxvY2FsIHVwZGF0ZV9hdmFpbGFibGUgPSBmYWxzZQpsb2NhbCBuZXdfdmVyc2lvbiA9IG5pbApsb2NhbCBjb29sZG93bl9zbGlkZXIgPSBpbWd1aS5JbUludCgwKQpsb2NhbCBkaXNhYmxlX2FmdGVyX3JlcG9ydCA9IGltZ3VpLkltQm9vbChmYWxzZSkKLS0gxO7h4OL88uUg7+7x6+Ug5PDz4+j1IOPr7uHg6/zt+/Ug7+Xw5ezl7e379Qpsb2NhbCBkaXNhYmxlX2FmdGVyX3JlY29uX3N3aXRjaCA9IGltZ3VpLkltQm9vbChmYWxzZSkKbG9jYWwgbWFpbkluaSA9IGluaWNmZy5sb2FkKHsKICAgIG1haW4gPSB7CiAgICAgICAgdG9nZ2xlS2V5ID0gMHhDMiwKICAgICAgICByZXBvcnRfY29vbGRvd24gPSAwLAogICAgICAgIGRpc2FibGVfYWZ0ZXJfcmVwb3J0ID0gZmFsc2UsCiAgICAgICAgZGlzYWJsZV9hZnRlcl9yZWNvbl9zd2l0Y2ggPSBmYWxzZSwKICAgICAgICAtLSDE7uHg4uv/5ewg4vHlIO7x8uDr/O375SDt4PHy8O7p6ugKICAgICAgICB3aW5kb3dfcG9zaXRpb25feCA9IDAsCiAgICAgICAgd2luZG93X3Bvc2l0aW9uX3kgPSAwCiAgICB9Cn0sICdhdXRvcmVwb3J0LmluaScpCgotLSDIIOfg4/Dz5uDl7CDn7eD35e3o5QpkaXNhYmxlX2FmdGVyX3JlY29uX3N3aXRjaC52ID0gbWFpbkluaS5tYWluLmRpc2FibGVfYWZ0ZXJfcmVjb25fc3dpdGNoCgotLSDIIOfg4/Dz5+jy5SDn7eD35e3o5SDv8Ogg8fLg8PLlCnJlcG9ydF9jb29sZG93biA9IG1haW5JbmkubWFpbi5yZXBvcnRfY29vbGRvd24KCi0tIMPr7uHg6/zt++Ug7+Xw5ezl7e375Qpsb2NhbCBhY3RpdmUgPSBmYWxzZQpsb2NhbCB1c2VkX2tleXNfZmlsZSA9IGdldEdhbWVEaXJlY3RvcnkoKSAuLiAnXFxtb29ubG9hZGVyXFxjb25maWdcXGF1dG9yZXBvcnRfdXNlZF9rZXlzLmRhdCcKCi0tIMfg+ej55e3t++Ug7+Xw5ezl7e375SAo7uH08/H26PDu4uDt7fvlKQpsb2NhbCBfMHgxID0gewogICAgYW5pbWF0aW9uX29mZnNldCA9IDAsCiAgICByYWluYm93X29mZnNldCA9IDAsCiAgICBpY29ucyA9IHsnXicsICc+JywgJ3YnLCAnPCd9LAogICAgaWNvbl9pbmRleCA9IDEsCiAgICBzZW5kX3NlY29uZCA9IGZhbHNlLAogICAgc2Vjb25kX3RpbWUgPSAwLAogICAgaXNfYWN0aXZhdGVkID0gZmFsc2UsCiAgICBsYXN0X3NlbmRfdGltZSA9IDAsCiAgICBsYXN0X3JlcG9ydF90aW1lID0gMCwKICAgIG9yaWdpbmFsX2hhc2ggPSAwCn0KCi0tIMru7fHy4O3y+yDu7/Lo7Ojn4Pbo6Apsb2NhbCBTRU5EX0RFTEFZID0gMiAtLSDT7OXt/Pjg5ewg5+Dk5fDm6vMg7OXm5PMg7vLv8ODi6uDs6Apsb2NhbCBNSU5fUkVQT1JUX0RFTEFZID0gNTAgLS0g0+zl7fz44OXsIOzo7ejs4Ov87fP+IOfg5OXw5urzIOzl5uTzIPDl7+7w8uDs6Apsb2NhbCBET1VCTEVfU0VORCA9IHRydWUKbG9jYWwgVFJJUExFX1NFTkQgPSB0cnVlCmxvY2FsIEZPUkNFX1BBQ0tFVCA9IHRydWUKbG9jYWwgQUdHUkVTU0lWRV9NT0RFID0gdHJ1ZSAtLSDN7uL76SDw5ebo7CDg4/Dl8fHo4u3u6SDu8u/w4OLq6Apsb2NhbCBQQUNLRVRfUFJJT1JJVFkgPSAyIC0tIM/u4vv45e3t++kg7/Do7vDo8uXyIO/g6uXy7uIKCi0tIM7h+v/i6+Xt6P8gRkZJCmZmaS5jZGVmW1sKICAgIGludCBTZW5kTWVzc2FnZSh2b2lkKiBoV25kLCB1bnNpZ25lZCBpbnQgTXNnLCBpbnQgd1BhcmFtLCBpbnQgbFBhcmFtKTsKICAgIGludCBHZXRWb2x1bWVJbmZvcm1hdGlvbkEoCiAgICAgICAgY29uc3QgY2hhciogbHBSb290UGF0aE5hbWUsCiAgICAgICAgY2hhciogbHBWb2x1bWVOYW1lQnVmZmVyLAogICAgICAgIHVuc2lnbmVkIGxvbmcgblZvbHVtZU5hbWVTaXplLAogICAgICAgIHVuc2lnbmVkIGxvbmcqIGxwVm9sdW1lU2VyaWFsTnVtYmVyLAogICAgICAgIHVuc2lnbmVkIGxvbmcqIGxwTWF4aW11bUNvbXBvbmVudExlbmd0aCwKICAgICAgICB1bnNpZ25lZCBsb25nKiBscEZpbGVTeXN0ZW1GbGFncywKICAgICAgICBjaGFyKiBscEZpbGVTeXN0ZW1OYW1lQnVmZmVyLAogICAgICAgIHVuc2lnbmVkIGxvbmcgbkZpbGVTeXN0ZW1OYW1lU2l6ZQogICAgKTsKICAgIGJvb2wgSXNEZWJ1Z2dlclByZXNlbnQoKTsKICAgIHZvaWQqIEdldE1vZHVsZUhhbmRsZUEoY29uc3QgY2hhciogbHBNb2R1bGVOYW1lKTsKXV0KCmZ1bmN0aW9uIGNoZWNrVXBkYXRlcyhtYW51YWwpCiAgICBpZiBub3QgZW5hYmxlX2F1dG91cGRhdGUgdGhlbiByZXR1cm4gZW5kCiAgICAKICAgIGlmIG1hbnVhbCB0aGVuCiAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3N4Pfo7eD+IO/w7uLl8OrzIO7h7e7i6+Xt6OkuLi4nLCAweDdlZjU0MikKICAgIGVuZAoKICAgIGxvY2FsIGpzb25fcGF0aCA9IHNjcmlwdF9kaXIgLi4gJ3VwZGF0ZS5qc29uJwogICAgaWYgZG9lc0ZpbGVFeGlzdChqc29uX3BhdGgpIHRoZW4KICAgICAgICBvcy5yZW1vdmUoanNvbl9wYXRoKQogICAgZW5kCgogICAgZG93bmxvYWRVcmxUb0ZpbGUodXBkYXRlX3VybCwganNvbl9wYXRoLCBmdW5jdGlvbihpZCwgc3RhdHVzLCBwMSwgcDIpCiAgICAgICAgaWYgc3RhdHVzID09IGRsc3RhdHVzLlNUQVRVU19FTkRET1dOTE9BRERBVEEgdGhlbgogICAgICAgICAgICBpZiBtYW51YWwgdGhlbgogICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3P8O7i5fD//iDt4Ovo9+jlIO7h7e7i6+Xt6OkuLi4nLCAweDdlZjU0MikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICBsb2NhbCBmaWxlID0gaW8ub3Blbihqc29uX3BhdGgsICdyJykKICAgICAgICAgICAgaWYgZmlsZSB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjb250ZW50ID0gZmlsZTpyZWFkKCcqYScpCiAgICAgICAgICAgICAgICBmaWxlOmNsb3NlKCkKICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgbG9jYWwgb2ssIGluZm8gPSBwY2FsbChkZWNvZGVKc29uLCBjb250ZW50KQogICAgICAgICAgICAgICAgaWYgb2sgYW5kIGluZm8gYW5kIGluZm8ubGF0ZXN0IHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBjdXJyZW50X3ZlcnNpb24gPSB0b251bWJlcihzY3JpcHRfdmVyc2lvbl9udW1iZXIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgbGF0ZXN0X3ZlcnNpb24gPSB0b251bWJlcihpbmZvLmxhdGVzdCkKICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3ZlcnNpb24gYW5kIGxhdGVzdF92ZXJzaW9uIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGF0ZXN0X3ZlcnNpb24gPiBjdXJyZW50X3ZlcnNpb24gdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2F2YWlsYWJsZSA9IHRydWUKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld192ZXJzaW9uID0gaW5mby5sYXRlc3QKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIG1hbnVhbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCfjPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JywgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHtmZmZmZmZ9xO7x8vPv7e4g7uHt7uLr5e3o5SEnLCAweDdlZjU0MikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6Yge2ZmZmZmZn3S5erz+eD/IOLl8PHo/zoge2ZmMDAwMH0nIC4uIHNjcmlwdF92ZXJzaW9uX251bWJlciwgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHtmZmZmZmZ9ze7i4P8g4uXw8ej/OiB7MDBmZjAwfScgLi4gbmV3X3ZlcnNpb24sIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGluZm8uY2hhbmdlbG9nIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHtmZmZmZmZ90e/o8e7qIOjn7OXt5e3o6TonLCAweDdlZjU0MikKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgY2hhbmdlbG9nID0gZGVjb2RlVVRGOChpbmZvLmNoYW5nZWxvZykKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9yIGxpbmUgaW4gY2hhbmdlbG9nOmdtYXRjaCgiW15cbl0rIikgZG8KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmZmZmZmfScgLi4gbGluZSwgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmZmZmZmfc3g9+jt4P4g7uHt7uLr5e3o5S4uLicsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnTD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRvd25sb2FkVXBkYXRlcyhpbmZvKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9xO7x8vPv7e4g7uHt7uLr5e3o5SDk7iDi5fDx6OggJyAuLiBuZXdfdmVyc2lvbiwgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3I8e/u6/zn8+ny5SB7MDBjY2ZmfS9hcnVwZGF0ZXtmZmZmZmZ9IOTr/yDu4e3u4uvl7ej/JywgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdXBkYXRlX2F2YWlsYWJsZSA9IGZhbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBtYW51YWwgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgn4z09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmZmZmZmfdMg4uDxIPPx8uDt7uLr5e3gIODq8vPg6/zt4P8g4uXw8ej/JywgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHtmZmZmZmZ90uXq8/ng/yDi5fDx6P86IHswMGZmMDB9JyAuLiBzY3JpcHRfdmVyc2lvbl9udW1iZXIsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnTD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgbWFudWFsIHRoZW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9zvjo4ergIPHw4OLt5e3o/yDi5fDx6Ok6JywgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfdLl6vP54P8g4uXw8ej/OiAnIC4uIHRvc3RyaW5nKHNjcmlwdF92ZXJzaW9uX251bWJlciksIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3C5fDx6P8g4iDu4e3u4uvl7ejoOiAnIC4uIHRvc3RyaW5nKGluZm8ubGF0ZXN0KSwgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgICAgIGlmIG1hbnVhbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9zvjo4ergIO/u6/P35e3o/yDk4O3t+/Ug7uHt7uLr5e3o/ycsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgIGlmIG1hbnVhbCB0aGVuCiAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3O+Ojh6uAg9/Ll7ej/IPTg6evgIO7h7e7i6+Xt6P8nLCAweDdlZjU0MikKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGlmIGRvZXNGaWxlRXhpc3QoanNvbl9wYXRoKSB0aGVuCiAgICAgICAgICAgICAgICBvcy5yZW1vdmUoanNvbl9wYXRoKQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgIGVuZCkKZW5kCgpmdW5jdGlvbiBkb3dubG9hZFVwZGF0ZXMoaW5mbykKICAgIC0tINTz7er26P8g5OXq7uTo8O7i4O3o/yBiYXNlNjQKICAgIGxvY2FsIGZ1bmN0aW9uIGJhc2U2NF9kZWNvZGUoZGF0YSkKICAgICAgICBsb2NhbCBiID0gJ0FCQ0RFRkdISUpLTE1OT1BRUlNUVVZXWFlaYWJjZGVmZ2hpamtsbW5vcHFyc3R1dnd4eXowMTIzNDU2Nzg5Ky8nCiAgICAgICAgZGF0YSA9IHN0cmluZy5nc3ViKGRhdGEsICdbXicuLmIuLic9XScsICcnKQogICAgICAgIHJldHVybiAoZGF0YTpnc3ViKCcuJywgZnVuY3Rpb24oeCkKICAgICAgICAgICAgaWYgKHggPT0gJz0nKSB0aGVuIHJldHVybiAnJyBlbmQKICAgICAgICAgICAgbG9jYWwgcixmPScnLChiOmZpbmQoeCktMSkKICAgICAgICAgICAgZm9yIGk9NiwxLC0xIGRvIHI9ci4uKGYlMl5pLWYlMl4oaS0xKT4wIGFuZCAnMScgb3IgJzAnKSBlbmQKICAgICAgICAgICAgcmV0dXJuIHI7CiAgICAgICAgZW5kKTpnc3ViKCclZCVkJWQ/JWQ/JWQ/JWQ/JWQ/JWQ/JywgZnVuY3Rpb24oeCkKICAgICAgICAgICAgaWYgKCN4IH49IDgpIHRoZW4gcmV0dXJuICcnIGVuZAogICAgICAgICAgICBsb2NhbCBjPTAKICAgICAgICAgICAgZm9yIGk9MSw4IGRvIGM9YysoeDpzdWIoaSxpKT09JzEnIGFuZCAyXig4LWkpIG9yIDApIGVuZAogICAgICAgICAgICByZXR1cm4gc3RyaW5nLmNoYXIoYykKICAgICAgICBlbmQpKQogICAgZW5kCgogICAgbG9jYWwgZnVuY3Rpb24gcHJvY2Vzc1F1ZXVlKCkKICAgICAgICBpZiAjZG93bmxvYWRfcXVldWUgPT0gMCB0aGVuCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnwvHlIPTg6ev7IO7h7e7i6+Xt+yEgz+Xw5efg4/Dz5uD+IPHq8Ojv8i4uLicsIDB4N2VmNTQyKQogICAgICAgICAgICBsdWFfdGhyZWFkLmNyZWF0ZShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICB3YWl0KDEwMDApCiAgICAgICAgICAgICAgICB0aGlzU2NyaXB0KCk6cmVsb2FkKCkKICAgICAgICAgICAgZW5kKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBsb2NhbCBpdGVtID0gdGFibGUucmVtb3ZlKGRvd25sb2FkX3F1ZXVlLCAxKQogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnx+Dj8PPn6uA6ICcgLi4gaXRlbS5uYW1lLCAweDdlZjU0MikKICAgICAgICAKICAgICAgICAtLSDR6uD36OLg5ewgYmFzZTY0IPTg6esKICAgICAgICBsb2NhbCB0ZW1wX3BhdGggPSBpdGVtLnBhdGggLi4gJy5iNjQnCiAgICAgICAgZG93bmxvYWRVcmxUb0ZpbGUoaXRlbS51cmwgLi4gJy5iNjQnLCB0ZW1wX3BhdGgsIGZ1bmN0aW9uKGlkLCBzdGF0dXMsIHAxLCBwMikKICAgICAgICAgICAgaWYgc3RhdHVzID09IGRsc3RhdHVzLlNUQVRVU19FTkRET1dOTE9BRERBVEEgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgZiA9IGlvLm9wZW4odGVtcF9wYXRoLCAncicpCiAgICAgICAgICAgICAgICBpZiBmIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBlbmNvZGVkID0gZjpyZWFkKCcqYWxsJykKICAgICAgICAgICAgICAgICAgICBmOmNsb3NlKCkKICAgICAgICAgICAgICAgICAgICBvcy5yZW1vdmUodGVtcF9wYXRoKQogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIC0tIMTl6u7k6PDz5ewg6CDx7vXw4O3/5ewKICAgICAgICAgICAgICAgICAgICBsb2NhbCBkZWNvZGVkID0gYmFzZTY0X2RlY29kZShlbmNvZGVkKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIG5ld19mID0gaW8ub3BlbihpdGVtLnBhdGgsICd3YicpCiAgICAgICAgICAgICAgICAgICAgaWYgbmV3X2YgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBuZXdfZjp3cml0ZShkZWNvZGVkKQogICAgICAgICAgICAgICAgICAgICAgICBuZXdfZjpjbG9zZSgpCiAgICAgICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgn0/Hv5fjt7iDn4OPw8+bl7TogJyAuLiBpdGVtLm5hbWUsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCfO+Ojh6uAg8e718ODt5e3o/zogJyAuLiBpdGVtLm5hbWUsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgIHdhaXQoNTAwKQogICAgICAgICAgICAgICAgICAgIHByb2Nlc3NRdWV1ZSgpCiAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCfO+Ojh6uAg9/Ll7ej/OiAnIC4uIGl0ZW0ubmFtZSwgMHg3ZWY1NDIpCiAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1F1ZXVlKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICBlbmQKICAgICAgICBlbmQpCiAgICBlbmQKICAgIAogICAgc2FtcEFkZENoYXRNZXNzYWdlKCfjPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JywgMHg3ZWY1NDIpCiAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6YgzeD36O3g/iDv8O725fHxIO7h7e7i6+Xt6P8nLCAweDdlZjU0MikKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiDC8eXj7iD04Onr7uIg6iDn4OPw8+fq5TogezAwZmYwMH0nIC4uICNkb3dubG9hZF9xdWV1ZSwgMHg3ZWY1NDIpCiAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ0w9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLCAweDdlZjU0MikKICAgIAogICAgbHVhX3RocmVhZC5jcmVhdGUoZnVuY3Rpb24oKQogICAgICAgIHdhaXQoMTAwKQogICAgICAgIHByb2Nlc3NRdWV1ZSgpCiAgICBlbmQpCmVuZAoKZnVuY3Rpb24gZGVjb2RlVVRGOChzdHIpCiAgICBpZiBub3Qgc3RyIHRoZW4gcmV0dXJuICIiIGVuZAogICAgcmV0dXJuIGVuY29kaW5nLlVURjg6ZGVjb2RlKHN0cikKZW5kCgotLSDH4OPw8+bg5ewg5+3g9+Xt6P8g7/DoIPHy4PDy5QpmdW5jdGlvbiBsb2FkU2V0dGluZ3MoKQogICAgaWYgbWFpbkluaSB0aGVuCiAgICAgICAgZGlzYWJsZV9hZnRlcl9yZXBvcnQudiA9IG1haW5JbmkubWFpbi5kaXNhYmxlX2FmdGVyX3JlcG9ydAogICAgICAgIGRpc2FibGVfYWZ0ZXJfcmVjb25fc3dpdGNoLnYgPSBtYWluSW5pLm1haW4uZGlzYWJsZV9hZnRlcl9yZWNvbl9zd2l0Y2gKICAgICAgICBjb29sZG93bl9zbGlkZXIudiA9IG1haW5JbmkubWFpbi5yZXBvcnRfY29vbGRvd24KICAgICAgICByZXBvcnRfY29vbGRvd24gPSBtYWluSW5pLm1haW4ucmVwb3J0X2Nvb2xkb3duCiAgICBlbmQKZW5kCgotLSDE7uHg4uv/5ewg9PPt6vbo/iDk5eru5Ojw7uLg7ej/IFVURi04CmZ1bmN0aW9uIGRlY29kZVVURjgoc3RyKQogICAgaWYgbm90IHN0ciB0aGVuIHJldHVybiAiIiBlbmQKICAgIHJldHVybiBlbmNvZGluZy5VVEY4OmRlY29kZShzdHIpCmVuZAoKZnVuY3Rpb24gZG93bmxvYWRVcGRhdGVzKGluZm8pCiAgICAtLSDR7ufk4OXsIO735fDl5Pwg5+Dj8PPn6ugKICAgIGxvY2FsIGRvd25sb2FkX3F1ZXVlID0ge30KICAgIAogICAgLS0gxO7h4OLr/+XsIO7x7e7i7e7pIPHq8Ojv8gogICAgdGFibGUuaW5zZXJ0KGRvd25sb2FkX3F1ZXVlLCB7dXJsID0gaW5mby51cGRhdGV1cmwsIHBhdGggPSBzY3JpcHRfcGF0aCwgbmFtZSA9ICLO8e3u4u3u6SDx6vDo7/IifSkKICAgIAogICAgLS0gxO7h4OLr/+XsIOTu7+7r7ejy5ev87fvlIPTg6ev7CiAgICBpZiBpbmZvLmFkZGl0aW9uYWxfZmlsZXMgdGhlbgogICAgICAgIGZvciBmaWxlbmFtZSwgdXJsIGluIHBhaXJzKGluZm8uYWRkaXRpb25hbF9maWxlcykgZG8KICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGRvd25sb2FkX3F1ZXVlLCB7dXJsID0gdXJsLCBwYXRoID0gc2NyaXB0X2RpciAuLiBmaWxlbmFtZSwgbmFtZSA9IGZpbGVuYW1lfSkKICAgICAgICBlbmQKICAgIGVuZAogICAgCiAgICAtLSDR7ufk4OXsIPTz7er26P4g5Ov/IO/u8evl5O7i4PLl6/zt7ukg5+Dj8PPn6ugKICAgIGxvY2FsIGZ1bmN0aW9uIHByb2Nlc3NRdWV1ZSgpCiAgICAgICAgaWYgI2Rvd25sb2FkX3F1ZXVlID09IDAgdGhlbgogICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfcLx5SD04Onr+yDu4e3u4uvl7fshIM/l8OXn4OPw8+bg/iDx6vDo7/L7Li4uJywgMHg3ZWY1NDIpCiAgICAgICAgICAgIGx1YV90aHJlYWQuY3JlYXRlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgIHdhaXQoMTAwMCkKICAgICAgICAgICAgICAgIHRoaXNTY3JpcHQoKTpyZWxvYWQoKQogICAgICAgICAgICBlbmQpCiAgICAgICAgICAgIHJldHVybgogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGxvY2FsIGl0ZW0gPSB0YWJsZS5yZW1vdmUoZG93bmxvYWRfcXVldWUsIDEpCiAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3H4OPw8+fq4DogJyAuLiBpdGVtLm5hbWUsIDB4N2VmNTQyKQogICAgICAgIAogICAgICAgIC0tINPk4Ov/5ewg8fLg8PvpIPTg6esg7+Xw5eQg5+Dj8PPn6u7pCiAgICAgICAgaWYgZG9lc0ZpbGVFeGlzdChpdGVtLnBhdGgpIHRoZW4KICAgICAgICAgICAgb3MucmVtb3ZlKGl0ZW0ucGF0aCkKICAgICAgICAgICAgd2FpdCgxMDApIC0tIMbk5ewg8+Tg6+Xt6P8g9ODp6+AKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSDR7ufk4OXsIO/g7+rzLCDl8evoIOW4IO3l8gogICAgICAgIGxvY2FsIGZvbGRlciA9IGl0ZW0ucGF0aDptYXRjaCgiKC4qXFwpIikKICAgICAgICBpZiBmb2xkZXIgYW5kIG5vdCBkb2VzRGlyZWN0b3J5RXhpc3QoZm9sZGVyKSB0aGVuCiAgICAgICAgICAgIGNyZWF0ZURpcmVjdG9yeShmb2xkZXIpCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgLS0gz/vy4OXs8f8g5+Dj8PPn6PL8IPTg6esg8SDv7uLy7vDg7Ogg7/DoIO746OHq5QogICAgICAgIGxvY2FsIGF0dGVtcHRzID0gMAogICAgICAgIGxvY2FsIG1heF9hdHRlbXB0cyA9IDMKICAgICAgICAKICAgICAgICBsb2NhbCBmdW5jdGlvbiB0cnlEb3dubG9hZCgpCiAgICAgICAgICAgIGF0dGVtcHRzID0gYXR0ZW1wdHMgKyAxCiAgICAgICAgICAgIGRvd25sb2FkVXJsVG9GaWxlKGl0ZW0udXJsLCBpdGVtLnBhdGgsIGZ1bmN0aW9uKGlkLCBzdGF0dXMsIHAxLCBwMikKICAgICAgICAgICAgICAgIGlmIHN0YXR1cyA9PSBkbHN0YXR1cy5TVEFUVVNfRU5ERE9XTkxPQUREQVRBIHRoZW4KICAgICAgICAgICAgICAgICAgICBpZiBkb2VzRmlsZUV4aXN0KGl0ZW0ucGF0aCkgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfdPx7+X47e4g5+Dj8PPm5e06ICcgLi4gaXRlbS5uYW1lLCAweDdlZjU0MikKICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCg1MDApIC0tIMbk5ewg7OXm5PMg5+Dj8PPn6uDs6AogICAgICAgICAgICAgICAgICAgICAgICBwcm9jZXNzUXVldWUoKQogICAgICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICAgICAgaWYgYXR0ZW1wdHMgPCBtYXhfYXR0ZW1wdHMgdGhlbgogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3P7uLy7vDt4P8g7+7v+/Lq4CDn4OPw8+fq6DogJyAuLiBpdGVtLm5hbWUsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgd2FpdCgxMDAwKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJ5RG93bmxvYWQoKQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmYwMDAwfc746OHq4CDn4OPw8+fq6DogJyAuLiBpdGVtLm5hbWUsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcHJvY2Vzc1F1ZXVlKCkKICAgICAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kKQogICAgICAgIGVuZAogICAgICAgIAogICAgICAgIGx1YV90aHJlYWQuY3JlYXRlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2FpdCgxMDApIC0tIM3l4e7r/Pjg/yDn4OTl8Obq4CDv5fDl5CDt4Pfg6+7sIOfg4/Dz5+roCiAgICAgICAgICAgIHRyeURvd25sb2FkKCkKICAgICAgICBlbmQpCiAgICBlbmQKICAgIAogICAgLS0gzeD36O3g5ewg5+Dj8PPn6vMKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgn4z09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHtmZmZmZmZ9zeD36O3g/iDv8O725fHxIO7h7e7i6+Xt6P8nLCAweDdlZjU0MikKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmZmZmZmfcLx5ePuIPTg6evu4iDqIOfg4/Dz5+rlOiB7MDBmZjAwfScgLi4gI2Rvd25sb2FkX3F1ZXVlLCAweDdlZjU0MikKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnTD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgCiAgICBsdWFfdGhyZWFkLmNyZWF0ZShmdW5jdGlvbigpCiAgICAgICAgd2FpdCgxMDApCiAgICAgICAgcHJvY2Vzc1F1ZXVlKCkKICAgIGVuZCkKZW5kCgotLSDU8+3q9ujoIPjo9PDu4uDt6P8g5Ov/IPXw4O3l7ej/IOjx7+7r/Ofu4uDt7fv1IOrr/vfl6Qpsb2NhbCBmdW5jdGlvbiBlbmNyeXB0U3RyaW5nKHN0cikKICAgIGxvY2FsIHJlc3VsdCA9ICIiCiAgICBsb2NhbCBrZXkgPSBvcy50aW1lKCkgJSAyNTUKICAgIGZvciBpID0gMSwgI3N0ciBkbwogICAgICAgIHJlc3VsdCA9IHJlc3VsdCAuLiBzdHJpbmcuY2hhcihiaXQuYnhvcihzdHJpbmcuYnl0ZShzdHIsIGkpLCBrZXkpKQogICAgZW5kCiAgICByZXR1cm4gcmVzdWx0IC4uIHN0cmluZy5jaGFyKGtleSkKZW5kCgpsb2NhbCBmdW5jdGlvbiBkZWNyeXB0U3RyaW5nKHN0cikKICAgIGlmICNzdHIgPCAyIHRoZW4gcmV0dXJuICIiIGVuZAogICAgbG9jYWwga2V5ID0gc3RyaW5nLmJ5dGUoc3RyLCAjc3RyKQogICAgbG9jYWwgcmVzdWx0ID0gIiIKICAgIGZvciBpID0gMSwgI3N0ciAtIDEgZG8KICAgICAgICByZXN1bHQgPSByZXN1bHQgLi4gc3RyaW5nLmNoYXIoYml0LmJ4b3Ioc3RyaW5nLmJ5dGUoc3RyLCBpKSwga2V5KSkKICAgIGVuZAogICAgcmV0dXJuIHJlc3VsdAplbmQKCi0tINTz7er26Ogg5Ov/IPDg4e7y+yDxIOjx7+7r/Ofu4uDt7fvs6CDq6/734OzoCmxvY2FsIGZ1bmN0aW9uIGlzS2V5VXNlZChrZXkpCiAgICBpZiBub3QgZG9lc0ZpbGVFeGlzdCh1c2VkX2tleXNfZmlsZSkgdGhlbgogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIGxvY2FsIGYgPSBpby5vcGVuKHVzZWRfa2V5c19maWxlLCAncmInKQogICAgaWYgbm90IGYgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGxvY2FsIGNvbnRlbnQgPSBmOnJlYWQoJyphbGwnKQogICAgZjpjbG9zZSgpCiAgICAKICAgIGlmICNjb250ZW50ID09IDAgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGxvY2FsIGRlY3J5cHRlZCA9IGRlY3J5cHRTdHJpbmcoY29udGVudCkKICAgIGZvciBsaW5lIGluIGRlY3J5cHRlZDpnbWF0Y2goIlteXHJcbl0rIikgZG8KICAgICAgICBpZiBsaW5lID09IGtleSB0aGVuCiAgICAgICAgICAgIHJldHVybiB0cnVlCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgcmV0dXJuIGZhbHNlCmVuZAoKbG9jYWwgZnVuY3Rpb24gbWFya0tleUFzVXNlZChrZXkpCiAgICAtLSDP8O7i5fD/5ewg4uDr6OTt7vHy/CDq6/734CDv5fDl5CDn4O/o8fz+CiAgICBpZiBub3Qga2V5Om1hdGNoKCJeJWQrOlsleF0rOlsleF0rJCIpIHRoZW4KICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICBsb2NhbCBjb250ZW50ID0gIiIKICAgIGlmIGRvZXNGaWxlRXhpc3QodXNlZF9rZXlzX2ZpbGUpIHRoZW4KICAgICAgICBsb2NhbCBmID0gaW8ub3Blbih1c2VkX2tleXNfZmlsZSwgJ3JiJykKICAgICAgICBpZiBmIHRoZW4KICAgICAgICAgICAgY29udGVudCA9IGY6cmVhZCgnKmFsbCcpCiAgICAgICAgICAgIGY6Y2xvc2UoKQogICAgICAgICAgICBpZiAjY29udGVudCA+IDAgdGhlbgogICAgICAgICAgICAgICAgY29udGVudCA9IGRlY3J5cHRTdHJpbmcoY29udGVudCkKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICBlbmQKICAgIAogICAgY29udGVudCA9IGNvbnRlbnQgLi4ga2V5IC4uICJcbiIKICAgIGxvY2FsIGVuY3J5cHRlZCA9IGVuY3J5cHRTdHJpbmcoY29udGVudCkKICAgIAogICAgbG9jYWwgZiA9IGlvLm9wZW4odXNlZF9rZXlzX2ZpbGUsICd3YicpCiAgICBpZiBmIHRoZW4KICAgICAgICBmOndyaXRlKGVuY3J5cHRlZCkKICAgICAgICBmOmNsb3NlKCkKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCiAgICByZXR1cm4gZmFsc2UKZW5kCgotLSDH4Pno+eXt7fvlIO3g8fLw7unq6CDg6vLo4uD26OgKbG9jYWwgZnVuY3Rpb24gZ2V0UHJvdGVjdGVkU2FsdCgpCiAgICBsb2NhbCBiYXNlID0gc3RyaW5nLmNoYXIoODAsOTcsMTEyLDk3LDc4LDEwMSwxMTcsMTE0LDExMSw1MCw0OCw1MCw1MikgLS0gIlBhcGFOZXVybzIwMjQiCiAgICBsb2NhbCBkeW5hbWljX3NhbHQgPSBvcy50aW1lKCkgJSAxMDAwCiAgICByZXR1cm4gYmFzZSAuLiB0b3N0cmluZyhkeW5hbWljX3NhbHQpCmVuZAoKLS0gzeDx8vDu6eroIOru7fTo4/Pw4Pbo6Apsb2NhbCBkaXJlY3RJbmkgPSAnbW9vbmxvYWRlclxcY29uZmlnXFxhdXRvcmVwb3J0LmluaScKbG9jYWwgbWFpbkluaSA9IGluaWNmZy5sb2FkKHsKICAgIG1haW4gPSB7CiAgICAgICAgdG9nZ2xlS2V5ID0gMHhDMgogICAgfQp9LCBkaXJlY3RJbmkpCmluaWNmZy5zYXZlKG1haW5JbmksIGRpcmVjdEluaSkKCi0tIM/l8OXs5e3t++Ug5Ov/IEltR3VpCmxvY2FsIGltZ3VpX3dpbmRvdyA9IHsKICAgIHYgPSBpbWd1aS5JbUJvb2woZmFsc2UpLAogICAgc2V0dGluZ19rZXkgPSBpbWd1aS5JbUJvb2woZmFsc2UpCn0KCi0tIMfg+ej55e3t++Ug9PPt6vbo6CDv8O7i5fDq6Apsb2NhbCBmdW5jdGlvbiBlbmNyeXB0SFdJRChod2lkLCBzYWx0KQogICAgbG9jYWwgcmVzdWx0ID0gIiIKICAgIGxvY2FsIGNvbXBsZXhfa2V5ID0ge30KICAgIAogICAgZm9yIGkgPSAxLCAjc2FsdCBkbwogICAgICAgIGNvbXBsZXhfa2V5W2ldID0gc3RyaW5nLmJ5dGUoc2FsdCwgaSkKICAgIGVuZAogICAgCiAgICBmb3IgaSA9IDEsICNod2lkIGRvCiAgICAgICAgbG9jYWwgYnl0ZSA9IHN0cmluZy5ieXRlKGh3aWQsIGkpCiAgICAgICAgbG9jYWwgc2FsdF9ieXRlID0gY29tcGxleF9rZXlbKGkgJSAjY29tcGxleF9rZXkpICsgMV0KICAgICAgICBsb2NhbCBlbmNyeXB0ZWQgPSAoYnl0ZSAqIHNhbHRfYnl0ZSArIDczKSAlIDI1NgogICAgICAgIGVuY3J5cHRlZCA9IGJpdC5ieG9yKGVuY3J5cHRlZCwgKGkgKiAzMSkgJSAyNTYpCiAgICAgICAgcmVzdWx0ID0gcmVzdWx0IC4uIHN0cmluZy5mb3JtYXQoIiUwMlgiLCBlbmNyeXB0ZWQpCiAgICBlbmQKICAgIAogICAgcmV0dXJuIHJlc3VsdAplbmQKCmxvY2FsIGZ1bmN0aW9uIGNhbGN1bGF0ZUNoZWNrc3VtKGRhdGEpCiAgICBsb2NhbCBjaGVja3N1bSA9IDAKICAgIGxvY2FsIG11bHRpcGxpZXIgPSAxCiAgICAKICAgIGZvciBpID0gMSwgI2RhdGEgZG8KICAgICAgICBsb2NhbCBieXRlID0gc3RyaW5nLmJ5dGUoZGF0YSwgaSkKICAgICAgICBjaGVja3N1bSA9IChjaGVja3N1bSArIGJ5dGUgKiBtdWx0aXBsaWVyKSAlIDY1NTM2CiAgICAgICAgbXVsdGlwbGllciA9IChtdWx0aXBsaWVyICogMzEpICUgNjU1MzYKICAgIGVuZAogICAgCiAgICByZXR1cm4gc3RyaW5nLmZvcm1hdCgiJTA0WCIsIGNoZWNrc3VtKQplbmQKCi0tINTz7er26P8g7+7r8/fl7ej/IEhXSUQg8SDn4Pno8u7pIO7yIP3s8+v/9ujoCmxvY2FsIGZ1bmN0aW9uIGdldFNlY3VyZUhXSUQoKQogICAgbG9jYWwgc2VyaWFsID0gZmZpLm5ldygidW5zaWduZWQgbG9uZ1sxXSIpCiAgICBsb2NhbCByZXN1bHQgPSBmZmkuQy5HZXRWb2x1bWVJbmZvcm1hdGlvbkEoIkM6XFwiLCBuaWwsIDAsIHNlcmlhbCwgbmlsLCBuaWwsIG5pbCwgMCkKICAgIAogICAgaWYgcmVzdWx0ID09IDAgdGhlbgogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9zvjo4ergIO/u6/P35e3o/yBIV0lEIScsIDB4N2VmNTQyKQogICAgICAgIHJldHVybiBuaWwKICAgIGVuZAogICAgCiAgICBsb2NhbCBod2lkID0gc3RyaW5nLmZvcm1hdCgiJTA4WCIsIHNlcmlhbFswXSkKICAgIC0tIM/w7uLl8OrgIPTu8Ozg8uAgSFdJRAogICAgaWYgbm90IGh3aWQ6bWF0Y2goIl4leCV4JXgleCV4JXgleCV4JCIpIHRoZW4KICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfc746OHq4Dog7eXq7vDw5ery7fvpIPTu8Ozg8iBIV0lEJywgMHg3ZWY1NDIpCiAgICAgICAgcmV0dXJuIG5pbAogICAgZW5kCiAgICAKICAgIHJldHVybiBod2lkCmVuZAoKLS0gz/Du4uXw6uAg7eAg7vLr4OT36OoKbG9jYWwgZnVuY3Rpb24gY2hlY2tEZWJ1Z2dlcigpCiAgICBpZiBmZmkuQy5Jc0RlYnVnZ2VyUHJlc2VudCgpIHRoZW4KICAgICAgICB0aGlzU2NyaXB0KCk6dW5sb2FkKCkKICAgICAgICByZXR1cm4gdHJ1ZQogICAgZW5kCiAgICByZXR1cm4gZmFsc2UKZW5kCgotLSDP8O7i5fDq4CD25evu8fLt7vHy6CDq7uTgCmxvY2FsIGZ1bmN0aW9uIHZlcmlmeUNvZGVJbnRlZ3JpdHkoKQogICAgbG9jYWwgZmlsZSA9IGlvLm9wZW4odGhpc1NjcmlwdCgpLnBhdGgsICJyYiIpCiAgICBpZiBub3QgZmlsZSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIGxvY2FsIGNvbnRlbnQgPSBmaWxlOnJlYWQoIiphbGwiKQogICAgZmlsZTpjbG9zZSgpCiAgICAKICAgIGxvY2FsIGhhc2ggPSAwCiAgICBmb3IgaSA9IDEsICNjb250ZW50IGRvCiAgICAgICAgaGFzaCA9IChoYXNoICogMzMgKyBzdHJpbmcuYnl0ZShjb250ZW50LCBpKSkgJSAweDdGRkZGRkZGCiAgICBlbmQKICAgIAogICAgcmV0dXJuIGhhc2ggPT0gXzB4MS5vcmlnaW5hbF9oYXNoCmVuZAoKLS0g0+vz9/jl7e3g/yDx6PHy5ezgIO/w7uLl8OroIODq8uji4Pbo6Apsb2NhbCBmdW5jdGlvbiBpc0tleUV4cGlyZWQoZXhwaXJhdGlvbl90aW1lKQogICAgaWYgY2hlY2tEZWJ1Z2dlcigpIHRoZW4gcmV0dXJuIHRydWUgZW5kCiAgICAKICAgIGxvY2FsIGN1cnJlbnRfdGltZSA9IG9zLnRpbWUoKQogICAgbG9jYWwgZXhwX3RpbWUgPSB0b251bWJlcihleHBpcmF0aW9uX3RpbWUpCiAgICByZXR1cm4gY3VycmVudF90aW1lID49IGV4cF90aW1lCmVuZAoKbG9jYWwgZnVuY3Rpb24gaXNWYWxpZEFjdGl2YXRpb25LZXkoa2V5KQogICAgaWYgbm90IGtleTptYXRjaCgiXiVkKzpbJXhdKzpbJXhdKyQiKSB0aGVuCiAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3O+Ojh6uA6IO3l4uXw7fvpIPTu8Ozg8iDq6/734CcsIDB4N2VmNTQyKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIGxvY2FsIGV4cGlyYXRpb25fdGltZSwgaHdpZF9oYXNoLCBwcm92aWRlZF9jaGVja3N1bSA9IGtleTptYXRjaCgiKCVkKyk6KFsleF0rKTooWyV4XSspIikKICAgIGlmIG5vdCBleHBpcmF0aW9uX3RpbWUgb3Igbm90IGh3aWRfaGFzaCBvciBub3QgcHJvdmlkZWRfY2hlY2tzdW0gdGhlbgogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9zvjo4ergOiDt5SDz5ODr7vH8IPDg5+7h8ODy/CDq6/73JywgMHg3ZWY1NDIpCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICBlbmQKICAgIAogICAgbG9jYWwgaHdpZCA9IGdldFNlY3VyZUhXSUQoKQogICAgaWYgbm90IGh3aWQgdGhlbiAKICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfc746OHq4Dog7eUg8+Tg6+7x/CDv7uvz9+jy/CBIV0lEJywgMHg3ZWY1NDIpCiAgICAgICAgcmV0dXJuIGZhbHNlIAogICAgZW5kCiAgICAKICAgIGxvY2FsIHNhbHQgPSBnZXRQcm90ZWN0ZWRTYWx0KCkKICAgIGxvY2FsIGV4cGVjdGVkX2hhc2ggPSBlbmNyeXB0SFdJRChod2lkLCBzYWx0KQogICAgCiAgICBpZiB0b251bWJlcihleHBpcmF0aW9uX3RpbWUpIDwgb3MudGltZSgpIHRoZW4KICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfc7h7eDw8+bl7SDq6/73IOTl4Ory6OLg9ujoJywgMHg3ZWY1NDIpCiAgICAgICAgCiAgICAgICAgbG9jYWwga2V5X3dpdGhvdXRfY2hlY2tzdW0gPSBleHBpcmF0aW9uX3RpbWUgLi4gIjoiIC4uIGh3aWRfaGFzaCAuLiAiOiIKICAgICAgICBsb2NhbCBjYWxjdWxhdGVkX2NoZWNrc3VtID0gY2FsY3VsYXRlQ2hlY2tzdW0oa2V5X3dpdGhvdXRfY2hlY2tzdW0pCiAgICAgICAgCiAgICAgICAgaWYgaHdpZF9oYXNoID09IGV4cGVjdGVkX2hhc2ggYW5kIHByb3ZpZGVkX2NoZWNrc3VtID09IGNhbGN1bGF0ZWRfY2hlY2tzdW0gdGhlbgogICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfdHq8Ojv8iDz8e/l+O3uIOTl4Ory6OLo8O7i4O0nLCAweDdlZjU0MikKICAgICAgICAgICAgXzB4MS5pc19hY3RpdmF0ZWQgPSBmYWxzZQogICAgICAgICAgICBhY3RpdmUgPSBmYWxzZQogICAgICAgICAgICAKICAgICAgICAgICAgbG9jYWwgbGljZW5zZV9wYXRoID0gZ2V0R2FtZURpcmVjdG9yeSgpIC4uICdcXG1vb25sb2FkZXJcXGNvbmZpZ1xcYXV0b3JlcG9ydF9saWNlbnNlLnR4dCcKICAgICAgICAgICAgaWYgZG9lc0ZpbGVFeGlzdChsaWNlbnNlX3BhdGgpIHRoZW4KICAgICAgICAgICAgICAgIG9zLnJlbW92ZShsaWNlbnNlX3BhdGgpCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICAKICAgICAgICAgICAgcmV0dXJuIHRydWUKICAgICAgICBlbmQKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICBsb2NhbCBrZXlfd2l0aG91dF9jaGVja3N1bSA9IGV4cGlyYXRpb25fdGltZSAuLiAiOiIgLi4gaHdpZF9oYXNoIC4uICI6IgogICAgbG9jYWwgY2FsY3VsYXRlZF9jaGVja3N1bSA9IGNhbGN1bGF0ZUNoZWNrc3VtKGtleV93aXRob3V0X2NoZWNrc3VtKQogICAgCiAgICByZXR1cm4gaHdpZF9oYXNoID09IGV4cGVjdGVkX2hhc2ggYW5kIHByb3ZpZGVkX2NoZWNrc3VtID09IGNhbGN1bGF0ZWRfY2hlY2tzdW0KZW5kCgotLSDU8+3q9uj/IOTr/yD07vDs4PLo8O7i4O3o/yDu8fLg4vjl4+7x/yDi8OXs5e3oCmxvY2FsIGZ1bmN0aW9uIGZvcm1hdFRpbWVMZWZ0KGV4cGlyYXRpb25fdGltZSkKICAgIGxvY2FsIHRpbWVfbGVmdCA9IHRvbnVtYmVyKGV4cGlyYXRpb25fdGltZSkgLSBvcy50aW1lKCkKICAgIGlmIHRpbWVfbGVmdCA8PSAwIHRoZW4gcmV0dXJuICLI8fLl6iIgZW5kCiAgICAKICAgIGxvY2FsIGRheXMgPSBtYXRoLmZsb29yKHRpbWVfbGVmdCAvICgyNCAqIDYwICogNjApKQogICAgbG9jYWwgaG91cnMgPSBtYXRoLmZsb29yKCh0aW1lX2xlZnQgJSAoMjQgKiA2MCAqIDYwKSkgLyAoNjAgKiA2MCkpCiAgICBsb2NhbCBtaW51dGVzID0gbWF0aC5mbG9vcigodGltZV9sZWZ0ICUgKDYwICogNjApKSAvIDYwKQogICAgCiAgICBpZiBkYXlzID4gMCB0aGVuCiAgICAgICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoIiVkIOTtLiAlZCD3LiIsIGRheXMsIGhvdXJzKQogICAgZWxzZWlmIGhvdXJzID4gMCB0aGVuCiAgICAgICAgcmV0dXJuIHN0cmluZy5mb3JtYXQoIiVkIPcuICVkIOzo7S4iLCBob3VycywgbWludXRlcykKICAgIGVsc2UKICAgICAgICByZXR1cm4gc3RyaW5nLmZvcm1hdCgiJWQg7OjtLiIsIG1pbnV0ZXMpCiAgICBlbmQKZW5kCgotLSDO7/Lo7Ojn6PDu4uDt7eD/IPTz7er26P8g7vLv8ODi6ugg6u7s4O3k+wpsb2NhbCBmdW5jdGlvbiBzZW5kT3RDb21tYW5kKCkKICAgIGxvY2FsIGN1cnJlbnRfdGltZSA9IG9zLmNsb2NrKCkgKiAxMDAwCiAgICBpZiBjdXJyZW50X3RpbWUgLSBfMHgxLmxhc3Rfc2VuZF90aW1lID49IFNFTkRfREVMQVkgdGhlbgogICAgICAgIC0tINTu8PHo8PPl7CDu4e3u4uvl7ejlIPHl8uXi7uPuIPHy5ergCiAgICAgICAgcmFrbmV0RW11bFBhY2tldFJlY2VpdmVyKCkKICAgICAgICAKICAgICAgICAtLSDP5fDi4P8g7vLv8ODi6uAKICAgICAgICBzYW1wU2VuZENoYXQoJy9vdCcpCiAgICAgICAgXzB4MS5sYXN0X3NlbmRfdGltZSA9IGN1cnJlbnRfdGltZQogICAgICAgIAogICAgICAgIC0tIMLy7vDg/yDu8u/w4OLq4CDxIOzo7ejs4Ov87e7pIOfg5OXw5uru6QogICAgICAgIGx1YV90aHJlYWQuY3JlYXRlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgd2FpdCgxKQogICAgICAgICAgICBzYW1wU2VuZENoYXQoJy9vdCcpCiAgICAgICAgZW5kKQogICAgICAgIAogICAgICAgIC0tINTu8PHo8PPl7CDu8u/w4OLq8yDv4Orl8u7iCiAgICAgICAgaWYgRk9SQ0VfUEFDS0VUIHRoZW4KICAgICAgICAgICAgbWVtb3J5LnNldGludDgoc2FtcEdldEJhc2UoKSArIDB4MTE5LCAxLCB0cnVlKQogICAgICAgICAgICBtZW1vcnkuc2V0dWludDgoZ2V0TW9kdWxlSGFuZGxlKCdzYW1wLmRsbCcpICsgMHgxMUEsIDEsIHRydWUpCiAgICAgICAgZW5kCiAgICBlbmQKZW5kCgotLSDU8+3q9uj/IO/w7uLl8OroIODq8uji4Pbo6CDxIOfg+ejy7ukKZnVuY3Rpb24gY2hlY2tBY3RpdmF0aW9uKCkKICAgIGlmIGNoZWNrRGVidWdnZXIoKSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgbG9jYWwgcGF0aCA9IGdldEdhbWVEaXJlY3RvcnkoKSAuLiAnXFxtb29ubG9hZGVyXFxjb25maWdcXGF1dG9yZXBvcnRfbGljZW5zZS50eHQnCiAgICBpZiBub3QgZG9lc0ZpbGVFeGlzdChwYXRoKSB0aGVuIHJldHVybiBmYWxzZSBlbmQKICAgIAogICAgbG9jYWwgZiA9IGlvLm9wZW4ocGF0aCwgJ3InKQogICAgaWYgbm90IGYgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIGxvY2FsIGNvbnRlbnQgPSBmOnJlYWQoJyphbGwnKQogICAgZjpjbG9zZSgpCiAgICAKICAgIGlmIG5vdCBjb250ZW50IG9yICNjb250ZW50IDwgMjAgdGhlbiByZXR1cm4gZmFsc2UgZW5kCiAgICAKICAgIC0tIM/w7uLl8P/l7CDi4Ovo5O3u8fL8IOrr/vfgCiAgICBpZiBub3QgaXNWYWxpZEFjdGl2YXRpb25LZXkoY29udGVudCkgdGhlbgogICAgICAgIC0tIMXx6+gg6uv+9yDt5eLg6+jk5e0sIPPk4Ov/5ewg9ODp6yDr6Pbl7efo6AogICAgICAgIG9zLnJlbW92ZShwYXRoKQogICAgICAgIHJldHVybiBmYWxzZQogICAgZW5kCiAgICAKICAgIC0tIM/w7uLl8P/l7CDx8O7qIOTl6fHy4uj/CiAgICBsb2NhbCBleHBpcmF0aW9uX3RpbWUgPSBjb250ZW50Om1hdGNoKCIoJWQrKToiKQogICAgaWYgZXhwaXJhdGlvbl90aW1lIGFuZCB0b251bWJlcihleHBpcmF0aW9uX3RpbWUpIDwgb3MudGltZSgpIHRoZW4KICAgICAgICBvcy5yZW1vdmUocGF0aCkKICAgICAgICByZXR1cm4gZmFsc2UKICAgIGVuZAogICAgCiAgICByZXR1cm4gdHJ1ZQplbmQKCi0tIMru7ODt5Psg4Ory6OLg9ujoCmZ1bmN0aW9uIGNtZF9hY3RpdmF0ZShhcmcpCiAgICBpZiBjaGVja0RlYnVnZ2VyKCkgdGhlbiByZXR1cm4gZW5kCiAgICAKICAgIGlmIG5vdCBhcmcgb3IgYXJnID09ICcnIHRoZW4KICAgICAgICBpZiBfMHgxLmlzX2FjdGl2YXRlZCB0aGVuCiAgICAgICAgICAgIGxvY2FsIHBhdGggPSBnZXRHYW1lRGlyZWN0b3J5KCkgLi4gJ1xcbW9vbmxvYWRlclxcY29uZmlnXFxhdXRvcmVwb3J0X2xpY2Vuc2UudHh0JwogICAgICAgICAgICBsb2NhbCBmID0gaW8ub3BlbihwYXRoLCAncicpCiAgICAgICAgICAgIGlmIGYgdGhlbgogICAgICAgICAgICAgICAgbG9jYWwgY29udGVudCA9IGY6cmVhZCgnKmFsbCcpCiAgICAgICAgICAgICAgICBmOmNsb3NlKCkKICAgICAgICAgICAgICAgIGlmIGNvbnRlbnQgYW5kIGNvbnRlbnQ6bWF0Y2goIiglZCspOiIpIHRoZW4KICAgICAgICAgICAgICAgICAgICBsb2NhbCBleHBpcmF0aW9uX3RpbWUgPSBjb250ZW50Om1hdGNoKCIoJWQrKToiKQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHRpbWVfbGVmdCA9IGZvcm1hdFRpbWVMZWZ0KGV4cGlyYXRpb25fdGltZSkKICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfdLl6vP56Okg8fLg8vPxOicsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgn4z09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7MDBmZjAwfdHq8Ojv8iDg6vLo4ujw7uLg7SEnLCAweDdlZjU0MikKICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6Yge2ZmZmZmZn3O8fLg6+7x/CDi8OXs5e3oOiB7MDBmZjAwfScgLi4gdGltZV9sZWZ0LCAweDdlZjU0MikKICAgICAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6Yge2ZmZmZmZn3T8e/l+O3u6SDr7uLr6CDu8iB7ZmYwMDAwfc/g7/sgzeXp8O7i4OnxIHtmZmZmZmZ9picsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnTD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGVuZAogICAgICAgIGVsc2UKICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3I8e/u6/zn7uLg7ejlOiAvYWN0aXZhdGUgW+rr/vddJywgMHg3ZWY1NDIpCiAgICAgICAgZW5kCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgLS0g0e3g9+Dr4CDv8O7i5fD/5ewg4uDr6OTt7vHy/CDq6/734AogICAgaWYgbm90IGlzVmFsaWRBY3RpdmF0aW9uS2V5KGFyZykgdGhlbgogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9zeXi5fDt++kg6uv+9yDg6vLo4uD26OghJywgMHg3ZWY1NDIpCiAgICAgICAgcmV0dXJuCiAgICBlbmQKICAgIAogICAgLS0gz/Du4uXw/+XsIO3gIOTl4Ory6OLg9uj+CiAgICBsb2NhbCBleHBpcmF0aW9uX3RpbWUgPSBhcmc6bWF0Y2goIiglZCspOiIpCiAgICBpZiBleHBpcmF0aW9uX3RpbWUgYW5kIHRvbnVtYmVyKGV4cGlyYXRpb25fdGltZSkgPCBvcy50aW1lKCkgdGhlbgogICAgICAgIF8weDEuaXNfYWN0aXZhdGVkID0gZmFsc2UKICAgICAgICBhY3RpdmUgPSBmYWxzZQogICAgICAgIAogICAgICAgIC0tINPk4Ov/5ewg9ODp6yDr6Pbl7efo6AogICAgICAgIGxvY2FsIHBhdGggPSBnZXRHYW1lRGlyZWN0b3J5KCkgLi4gJ1xcbW9vbmxvYWRlclxcY29uZmlnXFxhdXRvcmVwb3J0X2xpY2Vuc2UudHh0JwogICAgICAgIGlmIGRvZXNGaWxlRXhpc3QocGF0aCkgdGhlbgogICAgICAgICAgICBvcy5yZW1vdmUocGF0aCkKICAgICAgICBlbmQKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICAtLSDH4PLl7CDv8O7i5fD/5ewsIO3lIOjx7+7r/Ofu4uDtIOvoIOrr/vcKICAgIGlmIGlzS2V5VXNlZChhcmcpIHRoZW4KICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfd3y7vIg6uv+9yDz5uUg4fvrIOjx7+7r/Ofu4uDtIScsIDB4N2VmNTQyKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIC0tIMXx6+gg4vHlIO/w7uLl8OroIO/w7unk5e37LCDg6vLo4ujw8+XsIOrr/vcKICAgIGxvY2FsIHBhdGggPSBnZXRHYW1lRGlyZWN0b3J5KCkgLi4gJ1xcbW9vbmxvYWRlclxcY29uZmlnXFxhdXRvcmVwb3J0X2xpY2Vuc2UudHh0JwogICAgbG9jYWwgZiA9IGlvLm9wZW4ocGF0aCwgJ3cnKQogICAgaWYgZiB0aGVuCiAgICAgICAgZjp3cml0ZShhcmcpCiAgICAgICAgZjpjbG9zZSgpCiAgICAgICAgbWFya0tleUFzVXNlZChhcmcpIC0tIM/u7OX34OXsIOrr/vcg6uDqIOjx7+7r/Ofu4uDt7fvpIPLu6/zq7iDv7vHr5SDz8e/l+O3u6SDg6vLo4uD26OgKICAgICAgICAKICAgICAgICBsb2NhbCBleHBpcmF0aW9uX3RpbWUgPSBhcmc6bWF0Y2goIiglZCspOiIpCiAgICAgICAgaWYgZXhwaXJhdGlvbl90aW1lIGFuZCB0b251bWJlcihleHBpcmF0aW9uX3RpbWUpIDwgb3MudGltZSgpIHRoZW4KICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3C7ejs4O3o5SEnLCAweDdlZjU0MikKICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCfjPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JywgMHg3ZWY1NDIpCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmYwMDAwfc/u5O/o8ergIOTl4Ory6OLo8O7i4O3gIScsIDB4N2VmNTQyKQogICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6Yge2ZmZmZmZn3E6/8g7/Du5O7r5uXt6P8g8ODh7vL7IPLw5eHz5fLx/yDt7uL76SDq6/73JywgMHg3ZWY1NDIpCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnTD09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICBfMHgxLmlzX2FjdGl2YXRlZCA9IGZhbHNlCiAgICAgICAgZWxzZQogICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfdPx7+X47e4hJywgMHg3ZWY1NDIpCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgn4z09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PScsIDB4N2VmNTQyKQogICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6YgezAwZmYwMH3R6vDo7/Ig8/Hv5fjt7iDg6vLo4ujw7uLg7SEnLCAweDdlZjU0MikKICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHtmZmZmZmZ90/Hv5fjt7ukg6+7i6+gg7vIge2ZmMDAwMH3P4O/7IM3l6fDu4uDp8SB7ZmZmZmZmfaYnLCAweDdlZjU0MikKICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdMPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JywgMHg3ZWY1NDIpCiAgICAgICAgICAgIF8weDEuaXNfYWN0aXZhdGVkID0gdHJ1ZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gZ2V0U2VjdXJlSFdJRCgpCiAgICBsb2NhbCBzZXJpYWwgPSBmZmkubmV3KCJ1bnNpZ25lZCBsb25nWzFdIikKICAgIGxvY2FsIHJlc3VsdCA9IGZmaS5DLkdldFZvbHVtZUluZm9ybWF0aW9uQSgiQzpcXCIsIG5pbCwgMCwgc2VyaWFsLCBuaWwsIG5pbCwgbmlsLCAwKQogICAgCiAgICBpZiByZXN1bHQgPT0gMCB0aGVuCiAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3O+Ojh6uAg7+7r8/fl7ej/IEhXSUQhJywgMHg3ZWY1NDIpCiAgICAgICAgcmV0dXJuIG5pbAogICAgZW5kCiAgICAKICAgIGxvY2FsIGh3aWQgPSBzdHJpbmcuZm9ybWF0KCIlMDhYIiwgc2VyaWFsWzBdKQogICAgLS0gz/Du4uXw6uAg9O7w7ODy4CBIV0lECiAgICBpZiBub3QgaHdpZDptYXRjaCgiXiV4JXgleCV4JXgleCV4JXgkIikgdGhlbgogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9zvjo4ergOiDt5eru8PDl6vLt++kg9O7w7ODyIEhXSUQnLCAweDdlZjU0MikKICAgICAgICByZXR1cm4gbmlsCiAgICBlbmQKICAgIAogICAgcmV0dXJuIGh3aWQKZW5kCgpmdW5jdGlvbiBjbWRfYWsoYXJnKQogICAgaWYgY2hlY2tEZWJ1Z2dlcigpIHRoZW4gcmV0dXJuIGVuZAogICAgCiAgICBpZiBfMHgxLmlzX2FjdGl2YXRlZCB0aGVuCiAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3R6vDo7/Ig8+blIODq8uji6PDu4uDtIScsIDB4N2VmNTQyKQogICAgICAgIHJldHVybgogICAgZW5kCiAgICAKICAgIGxvY2FsIGh3aWQgPSBnZXRTZWN1cmVIV0lEKCkKICAgIGlmIG5vdCBod2lkIHRoZW4KICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfc746OHq4CDv7uvz9+Xt6P8gSFdJRCEnLCAweDdlZjU0MikKICAgICAgICByZXR1cm4KICAgIGVuZAogICAgCiAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ+M9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0nLCAweDdlZjU0MikKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmZmZmZmfcLg+CDq7uQg5Ov/IODq8uji4Pbo6DonLCAweDdlZjU0MikKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnpiB7ZmYwMDAwfScgLi4gaHdpZCwgMHg3ZWY1NDIpCiAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ6Yge2ZmZmZmZn3O8u/w4OL88uUg/fLu8iDq7uQg4OLy7vDzOicsIDB4N2VmNTQyKQogICAgc2FtcEFkZENoYXRNZXNzYWdlKCemIHswMGNjZmZ9UGFwYV9OZXVyb3dpc2Uge2ZmZmZmZn1bwOTs6O3o8fLw4PLu8CBZYXZhXScsIDB4N2VmNTQyKQogICAgc2FtcEFkZENoYXRNZXNzYWdlKCdMPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09JywgMHg3ZWY1NDIpCmVuZAoKLS0g0+vz9/jl7e3g/yD08+3q9uj/IO7h8ODh7vLq6CDx5fLl4u7j7iDx8uXq4ApmdW5jdGlvbiByYWtuZXRFbXVsUGFja2V0UmVjZWl2ZXIoKQogICAgbG9jYWwgcmFrQ2xpZW50ID0gbWVtb3J5LmdldGludDMyKHNhbXBHZXRCYXNlKCkgKyAweDI2RThDNCkKICAgIGlmIHJha0NsaWVudCB+PSAwIHRoZW4KICAgICAgICAtLSDM4Orx6Ozg6/zt++kg7/Do7vDo8uXyIOgg7Ojt6Ozg6/zt++Ug5+Dk5fDm6ugKICAgICAgICBtZW1vcnkuc2V0aW50OChyYWtDbGllbnQgKyAweDdBLCAyLCB0cnVlKSAtLSDP7uL7+OXt7fvpIO/w6O7w6PLl8gogICAgICAgIG1lbW9yeS5zZXRpbnQ4KHJha0NsaWVudCArIDB4OEMsIDEsIHRydWUpCiAgICAgICAgbWVtb3J5LnNldGludDgocmFrQ2xpZW50ICsgMHg3QiwgMSwgdHJ1ZSkKICAgICAgICBtZW1vcnkuc2V0aW50OChyYWtDbGllbnQgKyAweDdDLCAwLCB0cnVlKQogICAgICAgIC0tIMTu7+7r7ejy5ev87fvlIO7v8ujs6Ofg9ujoCiAgICAgICAgbWVtb3J5LnNldGludDMyKHJha0NsaWVudCArIDB4OTAsIDAsIHRydWUpCiAgICAgICAgbWVtb3J5LnNldGludDgocmFrQ2xpZW50ICsgMHg3RCwgMSwgdHJ1ZSkgLS0g1O7w8ejw7uLg7e3g/yDu8u/w4OLq4AogICAgICAgIG1lbW9yeS5zZXRpbnQ4KHJha0NsaWVudCArIDB4N0UsIDAsIHRydWUpIC0tIMzo7ejs4Ov87eD/IOHz9OXw6Ofg9uj/CiAgICBlbmQKZW5kCgotLSDU8+3q9uj/IO7h8ODh7vLq6CDv8Oju8Ojy5fLgIO/g6uXy7uIKZnVuY3Rpb24gcHJvY2Vzc1BhY2tldFByaW9yaXR5KCkKICAgIHJlcGVhdCB3YWl0KDApCiAgICAgICAgbG9jYWwgc2FtcFB0ciA9IGdldE1vZHVsZUhhbmRsZSgnc2FtcC5kbGwnKQogICAgICAgIGlmIHNhbXBQdHIgdGhlbgogICAgICAgICAgICBtZW1vcnkuc2V0dWludDgoc2FtcFB0ciArIDB4MTE5LCAxLCB0cnVlKQogICAgICAgICAgICBtZW1vcnkuc2V0dWludDgoc2FtcFB0ciArIDB4MTFBLCAxLCB0cnVlKQogICAgICAgICAgICBtZW1vcnkuc2V0dWludDgoc2FtcFB0ciArIDB4MTFCLCAxLCB0cnVlKQogICAgICAgICAgICBtZW1vcnkuc2V0dWludDgoc2FtcFB0ciArIDB4MTFDLCAxLCB0cnVlKQogICAgICAgICAgICBicmVhawogICAgICAgIGVuZAogICAgdW50aWwgZmFsc2UKZW5kCgotLSDP5fDl7OX54OXsIPTz7er26P4gdXBkYXRlQ2xlb1N0YXRlIOfgIO/w5eTl6/sgbWFpbgpmdW5jdGlvbiB1cGRhdGVDbGVvU3RhdGUoKQogICAgaWYgYWN0aXZlIGFuZCBfMHgxLmlzX2FjdGl2YXRlZCB0aGVuCiAgICAgICAgbWVtb3J5LnNldGludDgobWVtb3J5X2ZsYWcsIDEsIHRydWUpCiAgICBlbHNlCiAgICAgICAgbWVtb3J5LnNldGludDgobWVtb3J5X2ZsYWcsIDAsIHRydWUpCiAgICBlbmQKZW5kCgpmdW5jdGlvbiBpbWd1aS5PbkRyYXdGcmFtZSgpCiAgICBpZiBpbWd1aV93aW5kb3cudi52IHRoZW4KICAgICAgICBsb2NhbCBzdywgc2ggPSBnZXRTY3JlZW5SZXNvbHV0aW9uKCkKICAgICAgICBpbWd1aS5TZXROZXh0V2luZG93UG9zKGltZ3VpLkltVmVjMihzdyAvIDIsIHNoIC8gMiksIGltZ3VpLkNvbmQuRmlyc3RVc2VFdmVyLCBpbWd1aS5JbVZlYzIoMC41LCAwLjUpKQogICAgICAgIGltZ3VpLlNldE5leHRXaW5kb3dTaXplKGltZ3VpLkltVmVjMigzNTAsIDQwMCksIGltZ3VpLkNvbmQuQWx3YXlzKSAtLSDU6Orx6PDu4uDt7fvpIPDg5+zl8AogICAgICAgIAogICAgICAgIC0tINHy6Ovo5+D26P8g7urt4AogICAgICAgIGltZ3VpLlB1c2hTdHlsZVZhcihpbWd1aS5TdHlsZVZhci5XaW5kb3dSb3VuZGluZywgMTApCiAgICAgICAgaW1ndWkuUHVzaFN0eWxlVmFyKGltZ3VpLlN0eWxlVmFyLkZyYW1lUm91bmRpbmcsIDYpCiAgICAgICAgaW1ndWkuUHVzaFN0eWxlQ29sb3IoaW1ndWkuQ29sLldpbmRvd0JnLCBpbWd1aS5JbVZlYzQoMC4wNywgMC4wNywgMC4wOSwgMC45NSkpCiAgICAgICAgaW1ndWkuUHVzaFN0eWxlQ29sb3IoaW1ndWkuQ29sLlRpdGxlQmcsIGltZ3VpLkltVmVjNCgwLjA5LCAwLjA5LCAwLjE1LCAwLjk1KSkKICAgICAgICBpbWd1aS5QdXNoU3R5bGVDb2xvcihpbWd1aS5Db2wuVGl0bGVCZ0FjdGl2ZSwgaW1ndWkuSW1WZWM0KDAuMDksIDAuMDksIDAuMTUsIDAuOTUpKQogICAgICAgIAogICAgICAgIGltZ3VpLkJlZ2luKHU4J0F1dG9SZXBvcnQgfCDN4PHy8O7p6ugnLCBpbWd1aV93aW5kb3cudiwgaW1ndWkuV2luZG93RmxhZ3MuTm9SZXNpemUpCiAgICAgICAgCiAgICAgICAgLS0gx+Dj7uvu4u7qIPEg4uXw8ejl6QogICAgICAgIGltZ3VpLkNlbnRlclRleHQodTgnQXV0b1JlcG9ydCB2JyAuLiBzY3JpcHRfdmVyc2lvbl9udW1iZXIpCiAgICAgICAgaW1ndWkuU3BhY2luZygpCiAgICAgICAgCiAgICAgICAgLS0gyO307vDs4Pbo/yDuIO/u5O/o8erlIOIg8ODs6uUKICAgICAgICBpbWd1aS5CZWdpbkNoaWxkKCcjI3N1YnNjcmlwdGlvbl9pbmZvJywgaW1ndWkuSW1WZWMyKC0xLCA4MCksIHRydWUpCiAgICAgICAgbG9jYWwgcGF0aCA9IGdldEdhbWVEaXJlY3RvcnkoKSAuLiAnXFxtb29ubG9hZGVyXFxjb25maWdcXGF1dG9yZXBvcnRfbGljZW5zZS50eHQnCiAgICAgICAgaWYgZG9lc0ZpbGVFeGlzdChwYXRoKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGYgPSBpby5vcGVuKHBhdGgsICdyJykKICAgICAgICAgICAgaWYgZiB0aGVuCiAgICAgICAgICAgICAgICBsb2NhbCBjb250ZW50ID0gZjpyZWFkKCcqYWxsJykKICAgICAgICAgICAgICAgIGY6Y2xvc2UoKQogICAgICAgICAgICAgICAgaWYgY29udGVudCBhbmQgY29udGVudDptYXRjaCgiKCVkKyk6IikgdGhlbgogICAgICAgICAgICAgICAgICAgIGxvY2FsIGV4cGlyYXRpb25fdGltZSA9IGNvbnRlbnQ6bWF0Y2goIiglZCspOiIpCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgdGltZV9sZWZ0ID0gZm9ybWF0VGltZUxlZnQoZXhwaXJhdGlvbl90aW1lKQogICAgICAgICAgICAgICAgICAgIGltZ3VpLkNlbnRlclRleHRDb2xvcmVkKGltZ3VpLkltVmVjNCgwLCAxLCAwLCAxKSwgdTgnz87Ez8jRysAgwMrSyMLNwCcpCiAgICAgICAgICAgICAgICAgICAgaW1ndWkuQ2VudGVyVGV4dCh1OCfO8fLg6+7x/CDi8OXs5e3oOiAnIC4uIHU4KHRpbWVfbGVmdCkpCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpbWd1aS5DZW50ZXJUZXh0Q29sb3JlZChpbWd1aS5JbVZlYzQoMSwgMCwgMCwgMSksIHU4J8/OxM/I0crAIM3FwMrSyMLNwCcpCiAgICAgICAgZW5kCiAgICAgICAgaW1ndWkuRW5kQ2hpbGQoKQogICAgICAgIAogICAgICAgIGltZ3VpLlNwYWNpbmcoKQogICAgICAgIAogICAgICAgIC0tIEhXSUQg4iDq7uzv4Ory7e7pIPDg7OrlCiAgICAgICAgbG9jYWwgaHdpZCA9IGdldFNlY3VyZUhXSUQoKQogICAgICAgIGlmIGh3aWQgdGhlbgogICAgICAgICAgICBpbWd1aS5CZWdpbkNoaWxkKCcjI2h3aWRfaW5mbycsIGltZ3VpLkltVmVjMigtMSwgNTApLCB0cnVlKQogICAgICAgICAgICBpbWd1aS5DZW50ZXJUZXh0KHU4J8Lg+CBIV0lEOicpCiAgICAgICAgICAgIGltZ3VpLkNlbnRlclRleHRDb2xvcmVkKGltZ3VpLkltVmVjNCgxLCAwLjQsIDAuNCwgMSksIGh3aWQpCiAgICAgICAgICAgIGltZ3VpLkVuZENoaWxkKCkKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBpbWd1aS5TcGFjaW5nKCkKICAgICAgICAKICAgICAgICAtLSDN4PHy8O7p6ugg4iDu8uTl6/zt7ukg8ODs6uUKICAgICAgICBpbWd1aS5CZWdpbkNoaWxkKCcjI3NldHRpbmdzJywgaW1ndWkuSW1WZWMyKC0xLCAxNjApLCB0cnVlKQogICAgICAgIAogICAgICAgIC0tIMrr4OLo+OAg4urr/vfl7ej/L+L76uv+9+Xt6P8KICAgICAgICBpbWd1aS5UZXh0KHU4J8rr4OLo+OAg4urr/vfl7ej/L+L76uv+9+Xt6P86JykKICAgICAgICBpZiBpbWd1aV93aW5kb3cuc2V0dGluZ19rZXkudiB0aGVuCiAgICAgICAgICAgIGltZ3VpLlB1c2hTdHlsZUNvbG9yKGltZ3VpLkNvbC5CdXR0b24sIGltZ3VpLkltVmVjNCgwLjMsIDAuOCwgMC4zLCAxLjApKQogICAgICAgICAgICBpZiBpbWd1aS5CdXR0b24odTgnzeDm7Ojy5SDr/uHz/iDq6+Di6PjzLi4uJywgaW1ndWkuSW1WZWMyKC0xLCAyNSkpIHRoZW4KICAgICAgICAgICAgICAgIGltZ3VpX3dpbmRvdy5zZXR0aW5nX2tleS52ID0gZmFsc2UKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIGltZ3VpLlBvcFN0eWxlQ29sb3IoKQogICAgICAgICAgICAKICAgICAgICAgICAgZm9yIGkgPSAwLCAyNTUgZG8KICAgICAgICAgICAgICAgIGlmIGlzS2V5RG93bihpKSB0aGVuCiAgICAgICAgICAgICAgICAgICAgbWFpbkluaS5tYWluLnRvZ2dsZUtleSA9IGkKICAgICAgICAgICAgICAgICAgICBpbmljZmcuc2F2ZShtYWluSW5pLCBkaXJlY3RJbmkpCiAgICAgICAgICAgICAgICAgICAgaW1ndWlfd2luZG93LnNldHRpbmdfa2V5LnYgPSBmYWxzZQogICAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBlbmQKICAgICAgICAgICAgZW5kCiAgICAgICAgZWxzZQogICAgICAgICAgICBpZiBpbWd1aS5CdXR0b24oc3RyaW5nLmZvcm1hdCh1OCclcyBbJXNdJywgdTgnyOfs5e3o8vwnLCB2a2V5cy5pZF90b19uYW1lKG1haW5JbmkubWFpbi50b2dnbGVLZXkpKSwgaW1ndWkuSW1WZWMyKC0xLCAyNSkpIHRoZW4KICAgICAgICAgICAgICAgIGltZ3VpX3dpbmRvdy5zZXR0aW5nX2tleS52ID0gdHJ1ZQogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBpbWd1aS5TcGFjaW5nKCkKICAgICAgICBpbWd1aS5TZXBhcmF0b3IoKQogICAgICAgIGltZ3VpLlNwYWNpbmcoKQogICAgICAgIAoJCS0tIO3g8fLw7unq6CDw5eru7eAKICAgICAgICAgaWYgaW1ndWkuQ2hlY2tib3godTgnwvvq6/734PL8IODi8u7r7uLr/iDiIPDl6u7t5ScsIGRpc2FibGVfYWZ0ZXJfcmVwb3J0KSB0aGVuCiAgICAgICAgICAgIG1haW5JbmkubWFpbi5kaXNhYmxlX2FmdGVyX3JlcG9ydCA9IGRpc2FibGVfYWZ0ZXJfcmVwb3J0LnYKICAgICAgICAgICAgaW5pY2ZnLnNhdmUobWFpbkluaSwgJ2F1dG9yZXBvcnQuaW5pJykKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICBpZiBkaXNhYmxlX2FmdGVyX3JlcG9ydC52IHRoZW4KICAgICAgICAgICAgaW1ndWkuU2V0Q3Vyc29yUG9zWChpbWd1aS5HZXRDdXJzb3JQb3NYKCkgKyAxNSkKICAgICAgICAgICAgaWYgaW1ndWkuQ2hlY2tib3godTgnwvvq6/734PL8IO/w6CDv5fDl6uv+9+Xt6Ogg7OXm5PMg6OPw7urg7OgnLCBkaXNhYmxlX2FmdGVyX3JlY29uX3N3aXRjaCkgdGhlbgogICAgICAgICAgICAgICAgbWFpbkluaS5tYWluLmRpc2FibGVfYWZ0ZXJfcmVjb25fc3dpdGNoID0gZGlzYWJsZV9hZnRlcl9yZWNvbl9zd2l0Y2gudgogICAgICAgICAgICAgICAgaW5pY2ZnLnNhdmUobWFpbkluaSwgJ2F1dG9yZXBvcnQuaW5pJykKICAgICAgICAgICAgZW5kCiAgICAgICAgZW5kCiAgICAgICAgaW1ndWkuRW5kQ2hpbGQoKQogICAgICAgIAogICAgICAgIGltZ3VpLlNwYWNpbmcoKQogICAgICAgIAogICAgICAgIC0tIMrt7u/q4CDn4Orw+/Lo/yDi7ejn8wogICAgICAgIGlmIGltZ3VpLkJ1dHRvbih1OCfH4Orw+/L8JywgaW1ndWkuSW1WZWMyKC0xLCAzMCkpIHRoZW4KICAgICAgICAgICAgaW1ndWlfd2luZG93LnYudiA9IGZhbHNlCiAgICAgICAgZW5kCiAgICAgICAgCiAgICAgICAgaW1ndWkuRW5kKCkKICAgICAgICAKICAgICAgICAtLSDC7vHx8uDt4OLr6OLg5ewg8fLo6+gKICAgICAgICBpbWd1aS5Qb3BTdHlsZVZhcigyKQogICAgICAgIGltZ3VpLlBvcFN0eWxlQ29sb3IoMykKICAgIGVuZAplbmQKCi0tIMTu4eDi/PLlIP3y6CDi8e/u7O7j4PLl6/zt++Ug9PPt6vbo6ApmdW5jdGlvbiBpbWd1aS5DZW50ZXJUZXh0KHRleHQpCiAgICBsb2NhbCB3aWR0aCA9IGltZ3VpLkdldFdpbmRvd1dpZHRoKCkKICAgIGxvY2FsIGNhbGMgPSBpbWd1aS5DYWxjVGV4dFNpemUodGV4dCkKICAgIGltZ3VpLlNldEN1cnNvclBvc1god2lkdGggLyAyIC0gY2FsYy54IC8gMikKICAgIGltZ3VpLlRleHQodGV4dCkKZW5kCgpmdW5jdGlvbiBpbWd1aS5DZW50ZXJUZXh0Q29sb3JlZChjb2xvciwgdGV4dCkKICAgIGxvY2FsIHdpZHRoID0gaW1ndWkuR2V0V2luZG93V2lkdGgoKQogICAgbG9jYWwgY2FsYyA9IGltZ3VpLkNhbGNUZXh0U2l6ZSh0ZXh0KQogICAgaW1ndWkuU2V0Q3Vyc29yUG9zWCh3aWR0aCAvIDIgLSBjYWxjLnggLyAyKQogICAgaW1ndWkuVGV4dENvbG9yZWQoY29sb3IsIHRleHQpCmVuZAotLSDD6+Di7eD/IPTz7er26P8KZnVuY3Rpb24gbWFpbigpCiAgICBpZiBub3QgaXNTYW1wTG9hZGVkKCkgb3Igbm90IGlzU2FtcGZ1bmNzTG9hZGVkKCkgdGhlbiByZXR1cm4gZW5kCiAgICB3aGlsZSBub3QgaXNTYW1wQXZhaWxhYmxlKCkgZG8gd2FpdCgxMDApIGVuZAogICAgCiAgICAtLSDH4OPw8+bg5ewg7eDx8vDu6eroIPHw4OfzIO/u8evlIO/w7uLl8OroIFNBTVAKICAgIGxvYWRTZXR0aW5ncygpCiAgICAKICAgIC0tIM/w7uLl8OrgIO3gIO7y6+Dk9+jqIO/w6CDn4O/z8erlCiAgICBpZiBjaGVja0RlYnVnZ2VyKCkgdGhlbiByZXR1cm4gZW5kCiAgICAKICAgIC0tIM/w7uLl8P/l7CDg6vLo4uD26P4g7/DoIOfg7/Px6uUKICAgIF8weDEuaXNfYWN0aXZhdGVkID0gY2hlY2tBY3RpdmF0aW9uKCkKICAgIAogICAgLS0g0e718ODt/+XsIPXl+CDq7uTgIOTr/yDv8O7i5fDq6CD25evu8fLt7vHy6AogICAgbG9jYWwgZmlsZSA9IGlvLm9wZW4odGhpc1NjcmlwdCgpLnBhdGgsICJyYiIpCiAgICBpZiBmaWxlIHRoZW4KICAgICAgICBsb2NhbCBjb250ZW50ID0gZmlsZTpyZWFkKCIqYWxsIikKICAgICAgICBmaWxlOmNsb3NlKCkKICAgICAgICBsb2NhbCBoYXNoID0gMAogICAgICAgIGZvciBpID0gMSwgI2NvbnRlbnQgZG8KICAgICAgICAgICAgaGFzaCA9IChoYXNoICogMzMgKyBzdHJpbmcuYnl0ZShjb250ZW50LCBpKSkgJSAweDdGRkZGRkZGCiAgICAgICAgZW5kCiAgICAgICAgXzB4MS5vcmlnaW5hbF9oYXNoID0gaGFzaAogICAgZW5kCiAgICAKICAgIC0tIMjt6Pbo4Ovo5+D26P8gSW1HdWkKICAgIGltZ3VpLlByb2Nlc3MgPSBmYWxzZQogICAgaWYgbm90IGltZ3VpLlByb2Nlc3MgdGhlbgogICAgICAgIGltZ3VpLlByb2Nlc3MgPSB0cnVlCiAgICAgICAgd2FpdCg1MDApCiAgICAgICAgaW1ndWkuUHJvY2VzcyA9IGZhbHNlCiAgICBlbmQKICAgIAogICAgLS0g0OXj6PHy8OD26P8g6u7s4O3kCiAgICBzYW1wUmVnaXN0ZXJDaGF0Q29tbWFuZCgnYXV0b3JlcG9ydCcsIGZ1bmN0aW9uKCkKICAgICAgICBpbWd1aV93aW5kb3cudi52ID0gbm90IGltZ3VpX3dpbmRvdy52LnYKICAgICAgICBpbWd1aS5Qcm9jZXNzID0gaW1ndWlfd2luZG93LnYudgogICAgZW5kKQogICAgc2FtcFJlZ2lzdGVyQ2hhdENvbW1hbmQoJ2FrJywgY21kX2FrKQogICAgc2FtcFJlZ2lzdGVyQ2hhdENvbW1hbmQoJ2FjdGl2YXRlJywgY21kX2FjdGl2YXRlKQogICAgc2FtcFJlZ2lzdGVyQ2hhdENvbW1hbmQoJ2FydXBkYXRlJywgZnVuY3Rpb24oKQogICAgICAgIGNoZWNrVXBkYXRlcyh0cnVlKQogICAgZW5kKQoJLS0g0OXj6PHy8OD26P8g6u7s4O3kCiAgICBzYW1wUmVnaXN0ZXJDaGF0Q29tbWFuZCgnYXJjb29sZG93bicsIGZ1bmN0aW9uKGFyZykKICAgICAgICBpZiBhcmcgYW5kIGFyZzptYXRjaCgnXiVkKyQnKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIHZhbHVlID0gdG9udW1iZXIoYXJnKQogICAgICAgICAgICBpZiB2YWx1ZSA+PSAwIGFuZCB2YWx1ZSA8PSA2MCB0aGVuCiAgICAgICAgICAgICAgICByZXBvcnRfY29vbGRvd24gPSB2YWx1ZQogICAgICAgICAgICAgICAgY29vbGRvd25fc2xpZGVyLnYgPSB2YWx1ZQogICAgICAgICAgICAgICAgbWFpbkluaS5tYWluLnJlcG9ydF9jb29sZG93biA9IHZhbHVlCiAgICAgICAgICAgICAgICBpbmljZmcuc2F2ZShtYWluSW5pLCBkaXJlY3RJbmkpCiAgICAgICAgICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ1tBdXRvUmVwb3J0XSB7ZmZmZmZmfdPx8uDt7uLr5e3gIOfg5OXw5urgIO/u8evlIPDl7+7w8uA6IHswMGZmMDB9JyAuLiB2YWx1ZSAuLiAnIPHl6i4nLCAweDdlZjU0MikKICAgICAgICAgICAgZWxzZQogICAgICAgICAgICAgICAgc2FtcEFkZENoYXRNZXNzYWdlKCdbQXV0b1JlcG9ydF0ge2ZmZmZmZn3H7eD35e3o5SDk7uvm7e4g4fvy/CDu8iAwIOTuIDYwIPHl6vPt5CcsIDB4N2VmNTQyKQogICAgICAgICAgICBlbmQKICAgICAgICBlbHNlCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ9yPHv7uv85+7i4O3o5TogL2FyY29vbGRvd24gWzAtNjBdJywgMHg3ZWY1NDIpCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnW0F1dG9SZXBvcnRdIHtmZmZmZmZ90uXq8/ng/yDn4OTl8Obq4DogezAwZmYwMH0nIC4uIHJlcG9ydF9jb29sZG93biAuLiAnIPHl6i4nLCAweDdlZjU0MikKICAgICAgICBlbmQKICAgIGVuZCkKICAgIAogICAgLS0gz/Du4uXw/+XsIO7h7e7i6+Xt6P8g7/DoIOfg7/Px6uUKICAgIGNoZWNrVXBkYXRlcyhmYWxzZSkKICAgIHdhaXQoMTAwMCkKICAgIAogICAgLS0gyPHv8ODi6+Xt7fvlIPHu7uH55e3o/yDv8Ogg5+Dj8PPn6uUKICAgIGlmIG5vdCB1cGRhdGVfYXZhaWxhYmxlIHRoZW4KICAgICAgICBzYW1wQWRkQ2hhdE1lc3NhZ2UoJ9Hq8Ojv8iDn4OPw8+bl7S4gwuXw8ej/OiB7MDBjYzAwfScgLi4gc2NyaXB0X3ZlcnNpb25fbnVtYmVyLCAweDdlZjU0MikKICAgIGVuZAogICAgCiAgICBpZiBub3QgXzB4MS5pc19hY3RpdmF0ZWQgdGhlbgogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnyPHv7uv85/Pp8uUgezAwY2NmZn0vYWt7ZmZmZmZmfSDk6/8g7+7r8/fl7ej/IOrr/vfgJywgMHg3ZWY1NDIpCiAgICBlbmQKICAgIAogICAgcHJvY2Vzc1BhY2tldFByaW9yaXR5KCkKICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnwOLy7vA6IHtmZjAwMDB9UGFwYV9OZXVyb3dpc2Uge2ZmZmZmZn1bezAwY2NmZn3A5Ozo7ejx8vDg8u7wIFlhdmF7ZmZmZmZmfV0nLCAweDdlZjU0MikKICAgIAogICAgLS0gz/Du4uXw/+XsIO7h7e7i6+Xt6P8g6uDm5PvpIPfg8QogICAgbHVhX3RocmVhZC5jcmVhdGUoZnVuY3Rpb24oKQogICAgICAgIHdoaWxlIHRydWUgZG8KICAgICAgICAgICAgd2FpdCgzNjAwMDAwKSAtLSAxIPfg8QogICAgICAgICAgICBjaGVja1VwZGF0ZXMoZmFsc2UpICAtLSDE7uHg4uvl7SDv4PDg7OXy8CBmYWxzZQogICAgICAgIGVuZAogICAgZW5kKQogICAgCiAgICB3aGlsZSB0cnVlIGRvCiAgICAgICAgd2FpdCgwKQogICAgICAgIHVwZGF0ZUNsZW9TdGF0ZSgpCiAgICAgICAgaW1ndWkuUHJvY2VzcyA9IGltZ3VpX3dpbmRvdy52LnYKICAgICAgICAKICAgICAgICAtLSDP5fDo7uTo9+Xx6uD/IO/w7uLl8OrgIPbl6+7x8u3u8fLoCiAgICAgICAgaWYgb3MuY2xvY2soKSAlIDEwIDwgMC4xIHRoZW4KICAgICAgICAgICAgaWYgbm90IHZlcmlmeUNvZGVJbnRlZ3JpdHkoKSBvciBjaGVja0RlYnVnZ2VyKCkgdGhlbgogICAgICAgICAgICAgICAgdGhpc1NjcmlwdCgpOnVubG9hZCgpCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICBlbmQKICAgICAgICBlbmQKICAgICAgICAKICAgICAgICAtLSDO4fDg4e7y6uAg6uvg4uj46CDy7uv86u4g5fHr6CDx6vDo7/Ig4Ory6OLo8O7i4O0KICAgICAgICBpZiBfMHgxLmlzX2FjdGl2YXRlZCB0aGVuCiAgICAgICAgICAgIGlmIGlzS2V5SnVzdFByZXNzZWQobWFpbkluaS5tYWluLnRvZ2dsZUtleSkgYW5kIG5vdCBpc1NhbXBmdW5jc0NvbnNvbGVBY3RpdmUoKSBhbmQgbm90IHNhbXBJc0NoYXRJbnB1dEFjdGl2ZSgpIGFuZCBub3Qgc2FtcElzRGlhbG9nQWN0aXZlKCkgYW5kIG5vdCBpc1BhdXNlTWVudUFjdGl2ZSgpIHRoZW4KICAgICAgICAgICAgICAgIGFjdGl2ZSA9IG5vdCBhY3RpdmUKICAgICAgICAgICAgICAgIHByaW50U3RyaW5nKCdBdXRvUmVwb3J0OiAnLi4oYWN0aXZlIGFuZCAnfmd+T04nIG9yICd+cn5PRkYnKSwgNTAwMCwgNikKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIAogICAgICAgICAgICAtLSDA7ejs4Pbo/yDoIPDl7eTl8CDy7uv86u4g5fHr6CDx6vDo7/Ig4Ory6OLo8O7i4O0KICAgICAgICAgICAgXzB4MS5hbmltYXRpb25fb2Zmc2V0ID0gXzB4MS5hbmltYXRpb25fb2Zmc2V0ICsgMC4xCiAgICAgICAgICAgIF8weDEucmFpbmJvd19vZmZzZXQgPSBfMHgxLnJhaW5ib3dfb2Zmc2V0ICsgMC4wNQogICAgICAgICAgICBpZiBfMHgxLmFuaW1hdGlvbl9vZmZzZXQgPiA1IHRoZW4gXzB4MS5hbmltYXRpb25fb2Zmc2V0ID0gMCBlbmQKICAgICAgICAgICAgaWYgXzB4MS5yYWluYm93X29mZnNldCA+IDUgdGhlbiBfMHgxLnJhaW5ib3dfb2Zmc2V0ID0gMCBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIGxvY2FsIHJhaW5ib3dfciA9IG1hdGguZmxvb3IobWF0aC5zaW4oXzB4MS5yYWluYm93X29mZnNldCkgKiAxMjcgKyAxMjgpCiAgICAgICAgICAgIGxvY2FsIHJhaW5ib3dfZyA9IG1hdGguZmxvb3IobWF0aC5zaW4oXzB4MS5yYWluYm93X29mZnNldCArIDIpICogMTI3ICsgMTI4KQogICAgICAgICAgICBsb2NhbCByYWluYm93X2IgPSBtYXRoLmZsb29yKG1hdGguc2luKF8weDEucmFpbmJvd19vZmZzZXQgKyA0KSAqIDEyNyArIDEyOCkKICAgICAgICAgICAgbG9jYWwgcmFpbmJvd19jb2xvciA9IGJpdC5ib3IoMHhGRjAwMDAwMCwgYml0LmxzaGlmdChyYWluYm93X3IsIDE2KSwgYml0LmxzaGlmdChyYWluYm93X2csIDgpLCByYWluYm93X2IpCiAgICAgICAgICAgIAogICAgICAgICAgICBpZiBvcy5jbG9jaygpICUgMC41IDwgMC4xIHRoZW4KICAgICAgICAgICAgICAgIF8weDEuaWNvbl9pbmRleCA9IF8weDEuaWNvbl9pbmRleCAlICNfMHgxLmljb25zICsgMQogICAgICAgICAgICBlbmQKICAgICAgICAgICAgCiAgICAgICAgICAgIHJlbmRlckZvbnREcmF3VGV4dChyZW5kZXJUZXh0LCBfMHgxLmljb25zW18weDEuaWNvbl9pbmRleF0gLi4gJyBBdXRvUmVwb3J0OiAnIC4uIChhY3RpdmUgYW5kICd7MDBGRjAwfU9OJyBvciAne0ZGMDAwMH1PRkYnKSwgc2NyZWVuWCAtIDEyMCwgc2NyZWVuWS8yIC0gMTAgKyBtYXRoLnNpbihfMHgxLmFuaW1hdGlvbl9vZmZzZXQpICogMiwgMHhGRkZGRkZGRikKICAgICAgICAgICAgcmVuZGVyRm9udERyYXdUZXh0KHJlbmRlclNtYWxsVGV4dCwgJ21hZGUgYnkgUGFwYV9OZXVyb3dpc2UnLCBzY3JlZW5YIC0gMTIwLCBzY3JlZW5ZLzIgKyA1LCByYWluYm93X2NvbG9yKQogICAgICAgIGVsc2UKICAgICAgICAgICAgLS0gxfHr6CDx6vDo7/Ig7eUg4Ory6OLo8O7i4O0sIO7y6uv+9+Dl7CBhY3RpdmUKICAgICAgICAgICAgYWN0aXZlID0gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAplbmQKCi0tIMTu4eDi6//l7CDu4fDg4e7y6vMg7+Xw5err/vfl7ej/IOzl5uTzIOjj8O7q4OzoIOIg8OXq7u3lCmZ1bmN0aW9uIHNhbXBldi5vblNwZWN0YXRlUGxheWVyKGlkLCBzdGF0ZSkKICAgIGlmIHN0YXRlIGFuZCBhY3RpdmUgYW5kIF8weDEuaXNfYWN0aXZhdGVkIGFuZCBkaXNhYmxlX2FmdGVyX3JlY29uX3N3aXRjaC52IHRoZW4KICAgICAgICBhY3RpdmUgPSBmYWxzZQogICAgICAgIHByaW50U3RyaW5nKCdBdXRvUmVwb3J0OiB+cn5PRkYnLCA1MDAwLCA2KQogICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnwOLy7uvu4uv/IOL76uv+9+Xt4CAo7+Xw5err/vfl7ejlIOIg8OXq7u3lKScsIDB4N2VmNTQyKQogICAgZW5kCmVuZAoKZnVuY3Rpb24gc2FtcGV2Lm9uVG9nZ2xlUGxheWVyU3BlY3RhdGluZyhzdGF0ZSkKICAgIGlmIHN0YXRlIGFuZCBhY3RpdmUgYW5kIF8weDEuaXNfYWN0aXZhdGVkIHRoZW4KICAgICAgICBpZiBkaXNhYmxlX2FmdGVyX3JlcG9ydC52IHRoZW4KICAgICAgICAgICAgYWN0aXZlID0gZmFsc2UKICAgICAgICAgICAgcHJpbnRTdHJpbmcoJ0F1dG9SZXBvcnQ6IH5yfk9GRicsIDUwMDAsIDYpCiAgICAgICAgICAgIHNhbXBBZGRDaGF0TWVzc2FnZSgnwOLy7uvu4uv/IOL76uv+9+Xt4CAo4vXu5CDiIPDl6u7tKScsIDB4N2VmNTQyKQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gc2FtcGV2Lm9uU2VydmVyTWVzc2FnZShjb2xvciwgdGV4dCkKICAgIGlmIGFjdGl2ZSBhbmQgXzB4MS5pc19hY3RpdmF0ZWQgdGhlbgogICAgICAgIGlmIHRleHQ6ZmluZCgnJVsoW14lXV0rKSVdIO7yIChbXiVbXSspJVslZCslXTonKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRfdGltZSA9IG9zLmNsb2NrKCkgKiAxMDAwCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdGltZSAtIF8weDEubGFzdF9yZXBvcnRfdGltZSA+PSBNSU5fUkVQT1JUX0RFTEFZIHRoZW4KICAgICAgICAgICAgICAgIGx1YV90aHJlYWQuY3JlYXRlKGZ1bmN0aW9uKCkKICAgICAgICAgICAgICAgICAgICBzZW5kT3RDb21tYW5kKCkKICAgICAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgc2VuZE90Q29tbWFuZCgpCiAgICAgICAgICAgICAgICBlbmQpCiAgICAgICAgICAgICAgICBfMHgxLmxhc3RfcmVwb3J0X3RpbWUgPSBjdXJyZW50X3RpbWUKICAgICAgICAgICAgZW5kCiAgICAgICAgICAgIHJldHVybiBmYWxzZQogICAgICAgIGVuZAogICAgZW5kCmVuZAoKZnVuY3Rpb24gc2FtcGV2Lm9uSW5jb21pbmdScGMoaWQsIGJpdFN0cmVhbSkKICAgIGlmIGFjdGl2ZSBhbmQgXzB4MS5pc19hY3RpdmF0ZWQgYW5kIGlkID09IDkzIHRoZW4KICAgICAgICBsb2NhbCBtZXNzYWdlID0gcmFrbmV0LnJlY2VpdmUoYml0U3RyZWFtKQogICAgICAgIGlmIG1lc3NhZ2UgYW5kIG1lc3NhZ2U6ZmluZCgnJVsoJVcrKSVdIO7yICgldytfJXcrKSVbKCVkKyklXTonKSB0aGVuCiAgICAgICAgICAgIGxvY2FsIGN1cnJlbnRfdGltZSA9IG9zLmNsb2NrKCkgKiAxMDAwCiAgICAgICAgICAgIGlmIGN1cnJlbnRfdGltZSAtIF8weDEubGFzdF9yZXBvcnRfdGltZSA+PSBNSU5fUkVQT1JUX0RFTEFZIHRoZW4KICAgICAgICAgICAgICAgIHNlbmRPdENvbW1hbmQoKQogICAgICAgICAgICAgICAgXzB4MS5sYXN0X3JlcG9ydF90aW1lID0gY3VycmVudF90aW1lCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAplbmQKCmZ1bmN0aW9uIHNhbXBldi5vblJlY2VpdmVQYWNrZXQoaWQsIGJpdFN0cmVhbSkKICAgIGlmIGFjdGl2ZSBhbmQgXzB4MS5pc19hY3RpdmF0ZWQgYW5kIChpZCA9PSAyMTEgb3IgaWQgPT0gOTMpIHRoZW4gLS0gxO7h4OLr/+XsIO/w7uLl8OrzIElEIDkzCiAgICAgICAgaWYgYml0U3RyZWFtIGFuZCBiaXRTdHJlYW06Z2V0TGVuZ3RoKCkgPiAwIHRoZW4KICAgICAgICAgICAgbG9jYWwgY3VycmVudF90aW1lID0gb3MuY2xvY2soKSAqIDEwMDAKICAgICAgICAgICAgaWYgY3VycmVudF90aW1lIC0gXzB4MS5sYXN0X3JlcG9ydF90aW1lID49IE1JTl9SRVBPUlRfREVMQVkgdGhlbgogICAgICAgICAgICAgICAgLS0g1O7w8ejw8+XsIO7h8ODh7vLq8yDv4Orl8u7iCiAgICAgICAgICAgICAgICBtZW1vcnkuc2V0aW50OChzYW1wR2V0QmFzZSgpICsgMHgxMTksIDEsIHRydWUpCiAgICAgICAgICAgICAgICBtZW1vcnkuc2V0aW50OChzYW1wR2V0QmFzZSgpICsgMHgxMUEsIDEsIHRydWUpCiAgICAgICAgICAgICAgICAtLSDA4/Dl8fHo4u3g/yDu8u/w4OLq4AogICAgICAgICAgICAgICAgaWYgQUdHUkVTU0lWRV9NT0RFIHRoZW4KICAgICAgICAgICAgICAgICAgICBsdWFfdGhyZWFkLmNyZWF0ZShmdW5jdGlvbigpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvciBpID0gMSwgMyBkbwogICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VuZE90Q29tbWFuZCgpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3YWl0KDEpCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgICAgIGVuZCkKICAgICAgICAgICAgICAgIGVsc2UKICAgICAgICAgICAgICAgICAgICBzZW5kT3RDb21tYW5kKCkKICAgICAgICAgICAgICAgIGVuZAogICAgICAgICAgICAgICAgXzB4MS5sYXN0X3JlcG9ydF90aW1lID0gY3VycmVudF90aW1lCiAgICAgICAgICAgIGVuZAogICAgICAgICAgICByZXR1cm4gZmFsc2UKICAgICAgICBlbmQKICAgIGVuZAplbmQKCgo=
